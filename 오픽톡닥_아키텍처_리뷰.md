# ì˜¤í”½í†¡ë‹¥ ì•„í‚¤í…ì²˜ ë¦¬ë·° â€” ì†Œë¦¬ë‹´ â†’ í”„ë¡œë•ì…˜ ì¬ì„¤ê³„

> ì†Œë¦¬ë‹´ì˜ í˜„ì¬ ë™ì‘ ë°©ì‹ì„ ë¶„ì„í•˜ê³ , ì—…ê³„ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ë¡œ ì¬ì„¤ê³„í•˜ê¸° ìœ„í•œ ë…¼ì˜ ë¬¸ì„œ

---

## í˜„ì¬ ì†Œë¦¬ë‹´ ê·œëª¨

| í•­ëª© | ìˆ˜ëŸ‰ |
|------|------|
| DB í…Œì´ë¸” | 23ê°œ+ |
| Edge Functions | ì•½ 44ê°œ |
| DB íŠ¸ë¦¬ê±° | 3ê°œ (custom_mode, user_sync, updated_at) |
| RPC í•¨ìˆ˜ | 2ê°œ (find_similar_questions, increment_usage) |
| master_questions | 510ê°œ (ì‹œìŠ¤í…œ SSOT) |
| answer_type | 11ê°€ì§€ (ì‹œìŠ¤í…œ ì „ì²´ ë¶„ê¸° ê¸°ì¤€) |

---

## ë°œê²¬ëœ ë¬¸ì œì  (15ê°œ)

### A. DB ì„¤ê³„ ë¬¸ì œ (6ê°œ)

#### A-1. FK ì œì•½ ì¡°ê±´ ì—†ìŒ âš ï¸ ë†’ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `submission_questions.master_question_id` â†’ `master_questions.question_id` ì°¸ì¡°ê°€ ì½”ë“œì—ì„œë§Œ ë³´ì¥
- **ìœ„í—˜**: DB ë ˆë²¨ì—ì„œ ê°•ì œí•˜ì§€ ì•Šì•„ ì˜ëª»ëœ ë°ì´í„°ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**: ëª…ì‹œì  FOREIGN KEY ì œì•½ + ON DELETE/UPDATE ì •ì±…
- **ê²°ì •**: ë‹¨ì¼ ê°’ ì°¸ì¡° = FK í•„ìˆ˜ | ë°°ì—´(TEXT[]) + ë¶ˆë³€ ë°ì´í„° = ë°°ì—´ ìœ ì§€, FK ìƒëµ | ì‚­ì œ: ì¢…ì†=CASCADE, ë³´í˜¸=RESTRICT

#### A-2. VARCHARë¡œ ëœ ìƒíƒœ/íƒ€ì… í•„ë“œ âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `status`, `mode`, `answer_type`, `combo_category` ë“± ì „ë¶€ VARCHAR
- **ìœ„í—˜**: ì˜¤íƒ€(`'descripion'`)ë‚˜ ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**: PostgreSQL ENUM íƒ€ì… ë˜ëŠ” CHECK ì œì•½ ì¡°ê±´
- **ì´ë¯¸ ì ìš©**: master_questionsì—ì„œ `survey_type`, `topic_category`, `answer_type` ENUM ì™„ë£Œ
- **ê²°ì •**: ê°’ì´ í™•ì •ëœ ê²ƒ = ENUM | í–¥í›„ ë³€í•  ìˆ˜ ìˆëŠ” ê²ƒ = CHECK ì œì•½ ì¡°ê±´ (ë³€ê²½ ìš©ì´)

#### A-3. DB íŠ¸ë¦¬ê±°ì— ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ âš ï¸ ë†’ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `process_custom_mode_questions()` íŠ¸ë¦¬ê±°ê°€ 14ê°œ ëŒ€ê¸°, í•„í„°ë§, ê·¸ë£¹í•‘, ì™„ì „ì„± ê²€ì¦, INSERTê¹Œì§€ ì „ë¶€ ìˆ˜í–‰
- **ìœ„í—˜**: ë””ë²„ê¹… ì–´ë ¤ì›€, í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€, ì‹¤íŒ¨ ì‹œ ì‚¬ì¼ëŸ°íŠ¸ ì˜¤ë¥˜
- **ê²°ì •**: ì½¤ë³´ ìƒì„± ë¡œì§ì„ Edge Functionìœ¼ë¡œ ì´ì „. íŠ¸ë¦¬ê±°ëŠ” ë‹¨ìˆœ ì‘ì—…ë§Œ (updated_at, user_sync). ì œì™¸ ê·œì¹™ë„ Edge Function ì½”ë“œì—ì„œ ê´€ë¦¬ (A-4 ë™ì‹œ í•´ê²°)

#### A-4. í•˜ë“œì½”ë”©ëœ ì œì™¸ ê·œì¹™ âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ (A-3ê³¼ í•¨ê»˜)
- **í˜„í™©**: DB íŠ¸ë¦¬ê±°ì—ì„œ ì¹´í˜/í•˜ì´í‚¹/ê³µì›ì„ í•˜ë“œì½”ë”©ìœ¼ë¡œ ì œì™¸
- **ìœ„í—˜**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³€ê²½ ì‹œ DB ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
- **ê²°ì •**: A-3ì—ì„œ ì½¤ë³´ ìƒì„± ë¡œì§ì´ Edge Functionìœ¼ë¡œ ì´ì „ë˜ë¯€ë¡œ, ì œì™¸ ê·œì¹™ë„ Edge Function ì½”ë“œì—ì„œ ê´€ë¦¬

#### A-5. ì½¤ë³´ ì €ì¥ ì´ì¤‘í™” âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**:
  - `custom_mode_questions` â€” DB íŠ¸ë¦¬ê±°ë¡œ ìë™ ìƒì„± (ë¹ˆì¶œ ëª¨ë“œìš©)
  - `submission_combos` â€” Step 3ì—ì„œ extractCombosFromSubmission() (ìµœì‹  ëª¨ë“œìš©)
- **ìœ„í—˜**: ë¹„ìŠ·í•œ ë°ì´í„°ê°€ ë‘ ê³³ì— ì €ì¥ â†’ ë™ê¸°í™” ë¬¸ì œ
- **ê²°ì •**: `submission_combos` í…Œì´ë¸” í•˜ë‚˜ë¡œ í†µí•©. `custom_mode_questions` ì œê±°. ë¹ˆë„ëŠ” GROUP BY COUNT(*)ë¡œ ê³„ì‚° (ì„±ëŠ¥ í•„ìš” ì‹œ MATERIALIZED VIEW). ì›ë³¸ ë°ì´í„° í•œ ê³³, ë¹ˆë„ëŠ” ê³„ì‚°í•´ì„œ ì‚¬ìš©

#### A-6. JSONB ê³¼ë‹¤ ì‚¬ìš© âš ï¸ ë‚®ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `mock_test_sessions.questions`ì— 15ë¬¸ì œ ì „ì²´ë¥¼ JSONB ë°°ì—´ë¡œ ì €ì¥
- **ìœ„í—˜**: ì •ê·œí™”ë˜ì§€ ì•Šì•„ master_questions ì—…ë°ì´íŠ¸ ì‹œ ë¶ˆì¼ì¹˜ ê°€ëŠ¥
- **ê²°ì •**: question_id ë°°ì—´(TEXT[])ë§Œ ì €ì¥. master_questionsëŠ” ë¶ˆë³€ì´ë¯€ë¡œ JOINìœ¼ë¡œ ìµœì‹  ë°ì´í„° ì¡°íšŒ. SSOT ì›ì¹™ ì¤€ìˆ˜

---

### B. ì•„í‚¤í…ì²˜ ë¬¸ì œ (5ê°œ)

#### B-1. FACT ì ìˆ˜ ê³„ì‚°ì´ í”„ë¡ íŠ¸ì—”ë“œì— ìˆìŒ âš ï¸ ë†’ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ë“±ê¸‰ íŒì •, FACT ì ìˆ˜ ê³„ì‚°)ì´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ì¡´ì¬
- **ìœ„í—˜**: ì‚¬ìš©ìê°€ DevToolsë¡œ ì¡°ì‘ ê°€ëŠ¥, ë¡œì§ ë³€ê²½ ì‹œ ì•± ì—…ë°ì´íŠ¸ í•„ìš”
- **ê²°ì •**: ê·œì¹™ì—”ì§„ + FACT ê³„ì‚° ëª¨ë‘ ë°±ì—”ë“œ(Edge Function)ë¡œ ì´ì „. í”„ë¡ íŠ¸ëŠ” ê²°ê³¼ë§Œ í‘œì‹œ

#### B-2. Fire-and-Forget ë¦¬í¬íŠ¸ ìƒì„± âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `mock-test-process-v7`ì—ì„œ ë¦¬í¬íŠ¸ ìƒì„±ì„ fire-and-forgetìœ¼ë¡œ íŠ¸ë¦¬ê±°, 2ì´ˆ í´ë§
- **ìœ„í—˜**: ìƒì„± ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ, ì˜êµ¬ ì‹¤íŒ¨ ì²˜ë¦¬ ë¶ˆëª…í™•
- **ê²°ì •**: Retry with backoff + Dead Letter íŒ¨í„´ ì ìš©. ìƒíƒœ ë¨¸ì‹ (pendingâ†’processingâ†’completed/failed) + ìµœëŒ€ 3íšŒ ì¬ì‹œë„(1ì´ˆâ†’2ì´ˆâ†’4ì´ˆ backoff) + ìµœì¢… ì‹¤íŒ¨ ì‹œ status='failed' ê¸°ë¡ + ì‚¬ìš©ìì—ê²Œ ìˆ˜ë™ ì¬ì‹œë„ ë²„íŠ¼ ì œê³µ. í´ë§ ìœ ì§€

#### B-3. CORS `*` í—ˆìš© âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: ëª¨ë“  Edge Functionì—ì„œ `Access-Control-Allow-Origin: '*'`
- **ìœ„í—˜**: í”„ë¡œë•ì…˜ì—ì„œ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ì•…ì˜ì  ìš”ì²­ ê°€ëŠ¥
- **ê²°ì •**: opictalkdoc.com, www.opictalkdoc.com, localhost:3000(ê°œë°œ)ë§Œ í—ˆìš©. ê·¸ ì™¸ ì°¨ë‹¨

#### B-4. í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ë¶„ì‚° âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**:
  - ì§€ê¸‰: `submissions-step3` (í›„ê¸° ì™„ë£Œ +100)
  - ì°¨ê°: `AIPermissionService` (ìŠ¤í¬ë¦½íŠ¸ -50, TTS -50, ëª¨ì˜ê³ ì‚¬ -50, Whisper -10)
  - ì”ì•¡: `users.points`
- **ê²°ì •**: í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì „ë©´ ì‚­ì œ. íšŸìˆ˜ì œë¡œ ì „í™˜ (í”Œëœë³„ ëª¨ì˜ê³ ì‚¬/ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© íšŸìˆ˜ ì œí•œ). users.points, user_points_history, AIPermissionService í¬ì¸íŠ¸ ë¡œì§ ëª¨ë‘ ì œê±°. êµ¬ë… í…Œì´ë¸”ì—ì„œ ë‚¨ì€ íšŸìˆ˜ë§Œ ê´€ë¦¬

#### B-5. í…Œì´ë¸”ëª… ë²„ì „ ì ‘ë¯¸ì‚¬ âš ï¸ ë‚®ìŒ
- **í˜„í™©**: `mock_test_evaluations_v7`, `mock_test_holistic_evaluations_v7` ë“±
- **ìœ„í—˜**: ë§ˆì´ê·¸ë ˆì´ì…˜ë§ˆë‹¤ í…Œì´ë¸”ì´ ëŠ˜ì–´ë‚¨, ë ˆê±°ì‹œ í…Œì´ë¸” ì •ë¦¬ ë¶€ë‹´
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**: ì˜¤í”½í†¡ë‹¥ì—ì„œëŠ” ë²„ì „ ì—†ì´ ê¹¨ë—í•˜ê²Œ ì‹œì‘
- **ê²°ì •**: [ì ìš© í™•ì •] ì˜¤í”½í†¡ë‹¥ì€ v ì ‘ë¯¸ì‚¬ ì—†ì´ ì§„í–‰

---

### C. ë°ì´í„° í”Œë¡œìš° ë¬¸ì œ (4ê°œ)

#### C-1. Edge Function 44ê°œë¡œ ê³¼ë„í•˜ê²Œ ë¶„ë¦¬ âš ï¸ ì¤‘ê°„
- **í˜„í™©**: í•˜ë‚˜ì˜ ëª¨ë“ˆì´ 10ê°œ+ í•¨ìˆ˜ë¡œ ìª¼ê°œì ¸ ìˆìŒ (ì˜ˆ: ëª¨ì˜ê³ ì‚¬ 12ê°œ)
- **ìœ„í—˜**: ê³µìœ  ë¡œì§ ì¤‘ë³µ, Cold Start ì¦ê°€, ë°°í¬/ê´€ë¦¬ ë³µì¡
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**:
  - Option A: ëª¨ë“ˆë³„ 1ê°œ í•¨ìˆ˜ + ë¼ìš°íŒ… (ì˜ˆ: `mock-test` í•¨ìˆ˜ 1ê°œì— GET/POST ë©”ì„œë“œë³„ ë¶„ê¸°)
  - Option B: ê¸°ëŠ¥ ë‹¨ìœ„ ê·¸ë£¹í•‘ (ì˜ˆ: 5~8ê°œë¡œ í†µí•©)
- **ê²°ì •**: ëª¨ë“ˆë³„ 1ê°œ Edge Function + ë‚´ë¶€ íŒŒì¼ ë¶„ë¦¬. index.tsëŠ” ë¼ìš°íŒ…ë§Œ ë‹´ë‹¹(~50ì¤„), ì‹¤ì œ ë¡œì§ì€ handlers/ í´ë”ì— íŒŒì¼ë³„ ë¶„ë¦¬. ê³µí†µ ì½”ë“œëŠ” _shared/ì—ì„œ import. ì†Œë¦¬ë‹´ 44ê°œ â†’ ì˜¤í”½í†¡ë‹¥ 6~8ê°œë¡œ í†µí•©

#### C-2. ìƒíƒœ í´ë§ (2ì´ˆ ê°„ê²©) âš ï¸ ë‚®ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: ë¦¬í¬íŠ¸ ìƒì„± ìƒíƒœë¥¼ 2ì´ˆ ê°„ê²©ìœ¼ë¡œ í´ë§
- **ëŒ€ì•ˆ**: Supabase Realtimeìœ¼ë¡œ DB ë³€ê²½ êµ¬ë…
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**:
  - ì§§ì€ ì‘ì—…(~10ì´ˆ): í´ë§ë„ ê´œì°®ìŒ
  - ê¸´ ì‘ì—…(~1ë¶„+): Realtime êµ¬ë…ì´ ë” íš¨ìœ¨ì 
- **ê²°ì •**: í‰ê°€ ì‘ì—…ì´ 2~3ë¶„ ì†Œìš”ë˜ë¯€ë¡œ Supabase Realtime êµ¬ë…ìœ¼ë¡œ ì „í™˜. ìƒíƒœ ë¨¸ì‹ (pendingâ†’processingâ†’completed/failed) ë³€ê²½ì„ Realtimeìœ¼ë¡œ ê°ì§€. Realtime ì‹¤íŒ¨ ì‹œ 5ì´ˆ ê°„ê²© í´ë§ìœ¼ë¡œ ìë™ í´ë°±

#### C-3. AI API ë¹„ìš© ë¹„íš¨ìœ¨ âš ï¸ ì¤‘ê°„ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**:
  - ì‰ë„ì‰: Whisper STT â†’ GPT-4 í‰ê°€ (ì´ì¤‘ í˜¸ì¶œ)
  - ëª¨ì˜ê³ ì‚¬: STT + Azure ë°œìŒ + GPT-4 ì²´í¬ë°•ìŠ¤ (ì‚¼ì¤‘ í˜¸ì¶œ)
- **ìµœì í™” ë°©ì•ˆ**:
  - ìºì‹±: ê°™ì€ ì§ˆë¬¸/ë‹µë³€ íŒ¨í„´ ìºì‹œ
  - ë°°ì¹˜ ì²˜ë¦¬: ì—¬ëŸ¬ ë¬¸í•­ í•œ ë²ˆì— í‰ê°€
  - ëª¨ë¸ ìµœì í™”: ê°„ë‹¨í•œ í‰ê°€ëŠ” ë” ì €ë ´í•œ ëª¨ë¸ ì‚¬ìš©
- **ê²°ì •**: ì†Œë¦¬ë‹´ V7ê¹Œì§€ ì´ë¯¸ ìµœì í™” ì™„ë£Œëœ ìƒíƒœ. ê¸°ì¡´ AI í˜¸ì¶œ ë°©ì‹ ê·¸ëŒ€ë¡œ ì´ê´€. ê° ë¬¸í•­ë³„ í”„ë¡¬í”„íŠ¸ê°€ ë‹¤ë¥´ë¯€ë¡œ ë°°ì¹˜/ìºì‹± íš¨ê³¼ ì œí•œì 

#### C-4. ë…¼ë¦¬ì  FKë§Œ ì¡´ì¬ (ë°°ì—´ ì°¸ì¡°) âš ï¸ ë†’ìŒ âœ… ê²°ì •ì™„ë£Œ
- **í˜„í™©**: `custom_mode_questions.question_ids TEXT[]`ëŠ” ë°°ì—´ì´ë¼ FK ì œì•½ ë¶ˆê°€
- **ìœ„í—˜**: ì‚­ì œëœ master_questionì˜ idê°€ ë°°ì—´ì— ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŒ
- **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**:
  - Option A: ì¡°ì¸ í…Œì´ë¸”ë¡œ ë³€ê²½ (ì •ê·œí™”)
  - Option B: ë°°ì—´ ìœ ì§€ + ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ê²€ì¦ (master_questionsëŠ” ê±°ì˜ ì•ˆ ë³€í•˜ë¯€ë¡œ)
- **ê²°ì •**: A-1(FK ì „ëµ) + A-5(custom_mode_questions ì œê±° â†’ submission_combos í†µí•©)ì— ì˜í•´ í•´ê²°. master_questionsëŠ” ë¶ˆë³€(510ê°œ)ì´ë¯€ë¡œ ë°°ì—´ ì°¸ì¡° ì‹œ FK ìƒëµ ì›ì¹™ ì ìš©

---

## ë…¼ì˜ ìˆœì„œ

### 1ë‹¨ê³„: ê³µí†µ ê¸°ë°˜ (DB ì„¤ê³„ ì›ì¹™) âœ… ì™„ë£Œ
- [x] FK ì „ëµ í•©ì˜ (A-1, C-4)
- [x] ENUM/CHECK ì „ëµ í•©ì˜ (A-2)
- [x] íŠ¸ë¦¬ê±° vs Edge Function ì›ì¹™ (A-3, A-4)
- [x] í…Œì´ë¸” ë„¤ì´ë° ê·œì¹™ (B-5)
- [x] CORS ì •ì±… (B-3)
- [x] í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„ (B-4)
- [x] Edge Function êµ¬ì¡° ì›ì¹™ (C-1)

### 2ë‹¨ê³„: ì‹œí—˜í›„ê¸° (ë°ì´í„°ë©) âœ… ì„¤ê³„ ì™„ë£Œ
- [x] submissions + submission_questions í…Œì´ë¸” ì„¤ê³„
- [x] ì½¤ë³´ ìƒì„± ë¡œì§ (A-3, A-4, A-5 ë°˜ì˜)
- [x] ë¹ˆë„ ë¶„ì„ API ì„¤ê³„
- [x] Edge Function êµ¬ì¡°

<details>
<summary>ğŸ“‹ 2ë‹¨ê³„ ìƒì„¸ ì„¤ê³„ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>

#### í…Œì´ë¸” ì„¤ê³„ (3ê°œ)

**submissions (í›„ê¸° ë§ˆìŠ¤í„°)**
```sql
CREATE TABLE submissions (
  id                SERIAL PRIMARY KEY,
  user_id           UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  exam_date         DATE NOT NULL,
  achieved_level    TEXT CHECK (achieved_level IN ('AL','IH','IM3','IM2','IM1','IL','NH')),
  exam_difficulty   TEXT NOT NULL CHECK (exam_difficulty IN ('6-6','6-5','5-5','5-4')),
  grade_before_exam TEXT,
  status            TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft','complete')),
  step_completed    SMALLINT NOT NULL DEFAULT 1,
  overall_review    TEXT,
  tips              TEXT,
  used_recommended_survey BOOLEAN DEFAULT false,
  survey_occupation TEXT,
  survey_student    TEXT,
  survey_course     TEXT,
  survey_housing    TEXT,
  survey_leisure    TEXT,
  survey_hobbies    TEXT,
  survey_sports     TEXT,
  survey_travel     TEXT,
  submitted_at      TIMESTAMPTZ,
  created_at        TIMESTAMPTZ DEFAULT NOW(),
  updated_at        TIMESTAMPTZ DEFAULT NOW()
);
```
- RLS: ë³¸ì¸ í›„ê¸°ë§Œ CRUD, ê³µê°œ í›„ê¸°ëŠ” ì „ì²´ ì½ê¸°
- ì¸ë±ìŠ¤: user_id, status, exam_date

**submission_questions (14ê°œ ì§ˆë¬¸ ê¸°ë¡)**
```sql
CREATE TABLE submission_questions (
  id                  SERIAL PRIMARY KEY,
  submission_id       INTEGER NOT NULL REFERENCES submissions(id) ON DELETE CASCADE,
  question_number     SMALLINT NOT NULL CHECK (question_number BETWEEN 2 AND 15),
  combo_type          TEXT NOT NULL CHECK (combo_type IN ('ì¼ë°˜ì½¤ë³´1','ì¼ë°˜ì½¤ë³´2','ì¼ë°˜ì½¤ë³´3','ë¡¤í”Œë ˆì´','ì–´ë“œë°´ìŠ¤')),
  topic               TEXT NOT NULL,
  master_question_id  TEXT REFERENCES master_questions(question_id),
  custom_question_text TEXT,
  is_not_remembered   BOOLEAN DEFAULT false,
  created_at          TIMESTAMPTZ DEFAULT NOW()
);
```
- FK: submission_id â†’ submissions(id) CASCADE, master_question_id â†’ master_questions(question_id)
- ì¸ë±ìŠ¤: submission_id, master_question_id

**submission_combos (í†µí•© ì½¤ë³´ â€” custom_mode_questions ëŒ€ì²´)**
```sql
CREATE TABLE submission_combos (
  id              SERIAL PRIMARY KEY,
  submission_id   INTEGER NOT NULL REFERENCES submissions(id) ON DELETE CASCADE,
  combo_type      TEXT NOT NULL CHECK (combo_type IN ('general_1','general_2','general_3','roleplay','advance')),
  topic           TEXT NOT NULL,
  question_ids    TEXT[] NOT NULL,
  created_at      TIMESTAMPTZ DEFAULT NOW()
);
```
- frequency ì»¬ëŸ¼ ì—†ìŒ â†’ GROUP BY COUNT(*)ë¡œ ê³„ì‚°
- ì¸ë±ìŠ¤: submission_id, combo_type

**ë¹ˆë„ ê³„ì‚° ì¿¼ë¦¬ ì˜ˆì‹œ:**
```sql
SELECT topic, combo_type, COUNT(*) as frequency
FROM submission_combos
GROUP BY topic, combo_type
ORDER BY frequency DESC;
```

#### Edge Function êµ¬ì¡° (2ê°œ)

**1. submissions/ (ì“°ê¸° ìœ„ì£¼)**
```
supabase/functions/submissions/
â”œâ”€â”€ index.ts                    â† ë¼ìš°íŒ… (~50ì¤„)
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ create-draft.ts         â† Step 1: draft ìƒì„± (ê¸°ì¡´ draft ì‚­ì œ â†’ ìƒˆ draft INSERT)
â”‚   â”œâ”€â”€ save-questions.ts       â† Step 2: 14ê°œ ì§ˆë¬¸ ì €ì¥ (ê¸°ì¡´ ì‚­ì œ â†’ 14ê°œ INSERT)
â”‚   â”œâ”€â”€ complete.ts             â† Step 3: í›„ê¸° ì™„ë£Œ + ì½¤ë³´ ìƒì„± (combo-extractor í˜¸ì¶œ)
â”‚   â”œâ”€â”€ list-my.ts              â† ë‚´ í›„ê¸° ëª©ë¡ (í˜ì´ì§€ë„¤ì´ì…˜)
â”‚   â”œâ”€â”€ list-public.ts          â† ê³µê°œ í›„ê¸° ëª©ë¡
â”‚   â”œâ”€â”€ get-detail.ts           â† í›„ê¸° ìƒì„¸ (master_questions JOIN)
â”‚   â”œâ”€â”€ delete.ts               â† í›„ê¸°/ë“œë˜í”„íŠ¸ ì‚­ì œ
â”‚   â””â”€â”€ update-grade.ts         â† ì„±ì  ì—…ë°ì´íŠ¸ (ì‹œí—˜ì¼+7ì¼ í›„ ê°€ëŠ¥)
â””â”€â”€ utils/
    â”œâ”€â”€ combo-extractor.ts      â† ì½¤ë³´ ìƒì„± ë¡œì§ (A-3 ë°˜ì˜: íŠ¸ë¦¬ê±°â†’í•¨ìˆ˜)
    â””â”€â”€ validation.ts           â† ì…ë ¥ ê²€ì¦
```

**2. analysis/ (ì½ê¸° ì „ìš© ë¶„ì„)**
```
supabase/functions/analysis/
â”œâ”€â”€ index.ts
â””â”€â”€ handlers/
    â”œâ”€â”€ frequency.ts            â† ë¹ˆë„ ë¶„ì„ (ë¯¸ì¸ì¦: ì–´ë“œë°´ìŠ¤ë§Œ, ì¸ì¦: ì „ì²´)
    â”œâ”€â”€ topic-questions.ts      â† ì£¼ì œë³„ ì¶œì œ ì§ˆë¬¸ ëª©ë¡
    â””â”€â”€ stats.ts                â† ì „ì²´ í†µê³„ (ì œì¶œ ìˆ˜, ìœ ë‹ˆí¬ ì§ˆë¬¸ ìˆ˜, ë“±ê¸‰/ë‚œì´ë„ ë¹„ìœ¨)
```

#### ë°ì´í„° í”Œë¡œìš°

```
[Step 1] ê¸°ë³¸ ì •ë³´ + ë°°ê²½ì„¤ë¬¸
  â†’ POST /submissions (create-draft)
  â†’ ê¸°ì¡´ draft ì‚­ì œ â†’ ìƒˆ submissions INSERT (status='draft', step_completed=1)

[Step 2] ì§ˆë¬¸ 14ê°œ ì…ë ¥ (2~15ë²ˆ)
  â†’ POST /submissions/:id/questions (save-questions)
  â†’ ê¸°ì¡´ submission_questions ì‚­ì œ â†’ 14ê°œ INSERT
  â†’ submissions ì—…ë°ì´íŠ¸ (step_completed=2)
  â€» DB íŠ¸ë¦¬ê±° ì—†ìŒ â€” ì½¤ë³´ëŠ” Step 3ì—ì„œ ìƒì„±

[Step 3] í›„ê¸° í…ìŠ¤íŠ¸ + ê¿€íŒ
  â†’ POST /submissions/:id/complete (complete)
  â†’ submissions ì—…ë°ì´íŠ¸ (step_completed=3, status='complete', submitted_at=NOW())
  â†’ combo-extractor.ts ì‹¤í–‰ â†’ submission_combosì— ìµœëŒ€ 5ê°œ INSERT
  â€» í¬ì¸íŠ¸ ì§€ê¸‰ ì—†ìŒ (B-4 íšŸìˆ˜ì œ ë°˜ì˜)
```

#### ì½¤ë³´ ìƒì„± ê·œì¹™ (combo-extractor.ts)

```
ì¼ë°˜ì½¤ë³´1 (2~4ë²ˆ, 3ë¬¸í•­): ëª¨ë‘ master_question_id ìˆê³ , ê¸°ì–µí•¨, ì œì™¸ì£¼ì œ ì•„ë‹˜ â†’ general_1
ì¼ë°˜ì½¤ë³´2 (5~7ë²ˆ, 3ë¬¸í•­): ê°™ì€ ì¡°ê±´ â†’ general_2
ì¼ë°˜ì½¤ë³´3 (8~10ë²ˆ, 3ë¬¸í•­): ê°™ì€ ì¡°ê±´ â†’ general_3
ë¡¤í”Œë ˆì´ (11~13ë²ˆ, 3ë¬¸í•­): ëª¨ë‘ master_question_id ìˆê³ , ê¸°ì–µí•¨ â†’ roleplay
ì–´ë“œë°´ìŠ¤ (14~15ë²ˆ, 2ë¬¸í•­): ëª¨ë‘ master_question_id ìˆê³ , ê¸°ì–µí•¨, ì œì™¸ì£¼ì œ ì•„ë‹˜ â†’ advance

ì œì™¸ ì£¼ì œ: ['ê³µì›', 'ì¹´í˜', 'í•˜ì´í‚¹'] â€” ì½”ë“œì—ì„œ ê´€ë¦¬ (A-4 ë°˜ì˜)
ì¡°ê±´ ë¯¸ì¶©ì¡± ì½¤ë³´ëŠ” ìƒì„±í•˜ì§€ ì•ŠìŒ
```

#### ë¹ˆë„ ë¶„ì„ ì ‘ê·¼ ì œì–´
- ë¯¸ë¡œê·¸ì¸: ì–´ë“œë°´ìŠ¤ ì¹´í…Œê³ ë¦¬ë§Œ ë…¸ì¶œ
- ë¡œê·¸ì¸: ì „ì²´ ì¹´í…Œê³ ë¦¬ (ì¼ë°˜ + ë¡¤í”Œë ˆì´ + ì–´ë“œë°´ìŠ¤)

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ ë³€ê²½ ìš”ì•½
| í•­ëª© | ì†Œë¦¬ë‹´ | ì˜¤í”½í†¡ë‹¥ |
|------|--------|----------|
| ì½¤ë³´ í…Œì´ë¸” | 2ê°œ (custom_mode_questions + submission_combos) | 1ê°œ (submission_combos) |
| ì½¤ë³´ ìƒì„± | DB íŠ¸ë¦¬ê±° + Edge Function | Edge Functionë§Œ (Step 3) |
| ë¹ˆë„ ê³„ì‚° | frequency ì»¬ëŸ¼ | GROUP BY COUNT(*) |
| í¬ì¸íŠ¸ ì§€ê¸‰ | Step 3ì—ì„œ +100 | ì—†ìŒ (íšŸìˆ˜ì œ) |
| Edge Function | 16ê°œ | 2ê°œ (submissions + analysis) |
| ì œì™¸ ê·œì¹™ | íŠ¸ë¦¬ê±°ì— í•˜ë“œì½”ë”© | combo-extractor.tsì—ì„œ ê´€ë¦¬ |
| combo_type ê°’ | í•œêµ­ì–´/ì˜ì–´ í˜¼ì¬ | ì˜ì–´ í†µì¼ (general_1/2/3, roleplay, advance) |

</details>

### 3ë‹¨ê³„: ëª¨ì˜ê³ ì‚¬ âœ… ì„¤ê³„ ì™„ë£Œ
- [x] ì„¸ì…˜/ë‹µë³€/í‰ê°€ í…Œì´ë¸” ì„¤ê³„ (A-6 ë°˜ì˜)
- [x] V7 í‰ê°€ â†’ ì²´í¬ë°•ìŠ¤ + ê·œì¹™ì—”ì§„ (B-1 ë°˜ì˜)
- [x] ë¦¬í¬íŠ¸ ìƒì„± íë¦„ (B-2 ë°˜ì˜)
- [x] ìƒíƒœ ê´€ë¦¬ (C-2 ë°˜ì˜)

<details>
<summary>ğŸ“‹ 3ë‹¨ê³„ ìƒì„¸ ì„¤ê³„ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>

#### í…Œì´ë¸” ì„¤ê³„ (4ê°œ + ì„¤ì • 1ê°œ)

**mock_test_sessions (ì„¸ì…˜ ê´€ë¦¬)**
```sql
CREATE TABLE mock_test_sessions (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id      TEXT UNIQUE NOT NULL,        -- 'mt_xxxxxxxx'
  user_id         UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  mode            TEXT NOT NULL CHECK (mode IN ('frequent','recent','custom')),
  status          TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active','completed','expired')),
  question_ids    TEXT[] NOT NULL,              -- A-6: question_id ë°°ì—´ë§Œ, JOINìœ¼ë¡œ ì¡°íšŒ
  current_question SMALLINT DEFAULT 1,
  total_questions  SMALLINT DEFAULT 15,
  metadata        JSONB,                        -- recent ëª¨ë“œ: used_combo_ids ë“±
  holistic_status TEXT DEFAULT 'pending' CHECK (holistic_status IN ('pending','processing','completed','failed')),
  report_retry_count SMALLINT DEFAULT 0,        -- B-2: ìµœëŒ€ 3íšŒ ì¬ì‹œë„
  report_error    TEXT,
  started_at      TIMESTAMPTZ DEFAULT NOW(),
  completed_at    TIMESTAMPTZ,
  expires_at      TIMESTAMPTZ                   -- ìƒì„± í›„ 24ì‹œê°„
);
```
- ì¸ë±ìŠ¤: (user_id, status), expires_at
- A-6 ë°˜ì˜: questions JSONB â†’ question_ids TEXT[] (master_questions JOINìœ¼ë¡œ ì¡°íšŒ)

**mock_test_answers (ë‹µë³€ + í‰ê°€ í í†µí•©)**
```sql
CREATE TABLE mock_test_answers (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id      TEXT NOT NULL REFERENCES mock_test_sessions(session_id) ON DELETE CASCADE,
  question_number SMALLINT NOT NULL,
  question_id     TEXT NOT NULL,
  audio_url       TEXT,
  audio_duration  NUMERIC(8,2),
  transcript      TEXT,
  word_count      INTEGER,
  filler_word_count INTEGER DEFAULT 0,
  long_pause_count  INTEGER DEFAULT 0,
  pronunciation_assessment JSONB,
  eval_status     TEXT DEFAULT 'pending' CHECK (eval_status IN ('pending','processing','stt_completed','evaluating','completed','failed','skipped')),
  eval_retry_count SMALLINT DEFAULT 0,          -- B-2: ì¬ì‹œë„ íšŸìˆ˜
  eval_error      TEXT,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(session_id, question_number)
);
```
- ì†Œë¦¬ë‹´ì˜ mock_test_queue í…Œì´ë¸”ì„ answersì— í†µí•© (eval_statusë¡œ ìƒíƒœ ê´€ë¦¬)

**mock_test_evaluations (ê°œë³„ ë¬¸í•­ í‰ê°€)**
```sql
CREATE TABLE mock_test_evaluations (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id      TEXT NOT NULL,
  user_id         UUID NOT NULL REFERENCES auth.users(id),
  question_number SMALLINT NOT NULL,
  question_id     TEXT NOT NULL,
  answer_type     TEXT NOT NULL,
  checkbox_type   TEXT CHECK (checkbox_type IN ('INT','ADV','AL')),
  checkbox_count  SMALLINT,
  checkboxes      JSONB,                       -- {ì²´í¬ë°•ìŠ¤ID: {pass, evidence}}
  pass_count      SMALLINT,
  fail_count      SMALLINT,
  pass_rate       NUMERIC(5,4),
  sentences       JSONB,
  corrections     JSONB,
  deep_analysis   JSONB,
  corrected_script JSONB,
  transcript      TEXT,
  wpm             NUMERIC(6,2),
  audio_duration  NUMERIC(8,2),
  filler_count    SMALLINT,
  long_pause_count SMALLINT,
  pronunciation_assessment JSONB,
  model           TEXT,
  prompt_version  TEXT DEFAULT 'v7.0',
  tokens_used     INTEGER,
  processing_time_ms INTEGER,
  skipped         BOOLEAN DEFAULT false,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(session_id, question_number)
);
```
- B-5 ë°˜ì˜: _v7 ì ‘ë¯¸ì‚¬ ì—†ìŒ

**mock_test_reports (ì¢…í•© í‰ê°€)**
```sql
CREATE TABLE mock_test_reports (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id      TEXT UNIQUE NOT NULL,
  user_id         UUID NOT NULL REFERENCES auth.users(id),
  -- ê·œì¹™ ì—”ì§„ ê²°ê³¼
  final_level     TEXT,                        -- NH|IL|IM1|IM2|IM3|IH|AL
  floor_status    TEXT,
  floor_level     TEXT,
  ceiling_status  TEXT,
  sympathetic_listener TEXT,
  -- ì²´í¬ë°•ìŠ¤ ì§‘ê³„
  int_pass_rate   NUMERIC(5,4),
  adv_pass_rate   NUMERIC(5,4),
  al_pass_rate    NUMERIC(5,4),
  valid_question_count SMALLINT,
  aggregated_int_checkboxes JSONB,
  aggregated_adv_checkboxes JSONB,
  aggregated_al_checkboxes  JSONB,
  al_judgment     TEXT,
  q12_gatekeeper  TEXT,
  skipped_questions JSONB,
  -- ìƒíƒœ ê´€ë¦¬ (B-2 ë°˜ì˜)
  rule_engine_status TEXT DEFAULT 'pending' CHECK (rule_engine_status IN ('pending','completed','failed')),
  report_status   TEXT DEFAULT 'pending' CHECK (report_status IN ('pending','processing','completed','failed')),
  -- FACT ì ìˆ˜
  score_f         NUMERIC(4,1),
  score_a         NUMERIC(4,1),
  score_c         NUMERIC(4,1),
  score_t         NUMERIC(4,1),
  total_score     NUMERIC(5,1),                -- (F+A+C+T) * 2.5 = 100ì  ë§Œì 
  -- ë¦¬í¬íŠ¸ í”¼ë“œë°±
  overall_comments_en TEXT,
  overall_comments_ko TEXT,
  int_performance     JSONB,
  adv_performance     JSONB,
  comprehensive_feedback TEXT,
  training_recommendations JSONB,
  -- ë°œìŒ í†µê³„
  avg_accuracy_score  NUMERIC(5,1),
  avg_prosody_score   NUMERIC(5,1),
  avg_fluency_score   NUMERIC(5,1),
  -- ë©”íƒ€ë°ì´í„°
  target_level    TEXT,
  test_date       DATE,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```
- B-5 ë°˜ì˜: holistic_evaluations_v7 â†’ mock_test_reports

**mock_test_eval_settings (ê´€ë¦¬ì ì„¤ì • â€” ë‹¨ì¼ í–‰)**
```sql
CREATE TABLE mock_test_eval_settings (
  id              INTEGER PRIMARY KEY DEFAULT 1,
  prompt_mode     TEXT DEFAULT 'original' CHECK (prompt_mode IN ('original','eval_only','parallel')),
  model_name      TEXT DEFAULT 'gpt-4.1',
  temperature     NUMERIC(3,2) DEFAULT 0.30,
  max_tokens      INTEGER DEFAULT 10000,
  retry_count     INTEGER DEFAULT 2,
  -- answer_typeë³„ í™œì„±í™” í† ê¸€
  enabled_description    BOOLEAN DEFAULT true,
  enabled_routine        BOOLEAN DEFAULT true,
  enabled_roleplay_11    BOOLEAN DEFAULT true,
  enabled_comparison     BOOLEAN DEFAULT true,
  enabled_past_experience BOOLEAN DEFAULT true,
  enabled_roleplay_12    BOOLEAN DEFAULT true,
  enabled_advanced_14    BOOLEAN DEFAULT true,
  enabled_advanced_15    BOOLEAN DEFAULT true,
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```

#### Edge Function êµ¬ì¡° (1ê°œ)

```
supabase/functions/mock-test/
â”œâ”€â”€ index.ts                        â† ë¼ìš°íŒ…
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ create-session.ts           â† ì„¸ì…˜ ìƒì„± + 15ë¬¸ì œ ì¶œì œ
â”‚   â”œâ”€â”€ submit-answer.ts            â† ë‹µë³€ ì œì¶œ + Storage ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ process-answer.ts           â† Stage A: Whisper STT + Azure ë°œìŒ
â”‚   â”œâ”€â”€ evaluate-answer.ts          â† Stage B: GPT-4.1 ì²´í¬ë°•ìŠ¤ í‰ê°€
â”‚   â”œâ”€â”€ generate-report.ts          â† ê·œì¹™ì—”ì§„ ì‹¤í–‰ + ë¦¬í¬íŠ¸ ìƒì„±
â”‚   â”œâ”€â”€ get-status.ts               â† í‰ê°€ ì§„í–‰ ìƒíƒœ ì¡°íšŒ
â”‚   â”œâ”€â”€ get-session.ts              â† ì„¸ì…˜ ìƒì„¸ / ë‹µë³€ / í‰ê°€ ì¡°íšŒ
â”‚   â”œâ”€â”€ get-history.ts              â† ì´ë ¥ ëª©ë¡
â”‚   â”œâ”€â”€ skip-question.ts            â† ë¬¸í•­ ìŠ¤í‚µ
â”‚   â””â”€â”€ combo-list.ts               â† ì»¤ìŠ¤í…€ ëª¨ë“œ ì½¤ë³´ ëª©ë¡
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ rule-engine.ts              â† V7 ê·œì¹™ ì—”ì§„ (B-1: ë“±ê¸‰ íŒì • ë°±ì—”ë“œ)
â”‚   â”œâ”€â”€ question-generator.ts       â† 15ë¬¸ì œ ìƒì„± ë¡œì§ (frequent/recent/custom)
â”‚   â”œâ”€â”€ checkbox-definitions.ts     â† INT(18)/ADV(38)/AL(6) ì²´í¬ë°•ìŠ¤ ì •ì˜
â”‚   â””â”€â”€ skip-detector.ts            â† 3ë‹¨ê³„ ìŠ¤í‚µ íŒì • (15ì´ˆ/15ì/í™˜ì²­)
```

#### í‰ê°€ í”Œë¡œìš° (2ë‹¨ê³„ ì•„í‚¤í…ì²˜ ìœ ì§€)

```
[ë‹µë³€ ì œì¶œ]
  â†’ submit-answer: Storage ì—…ë¡œë“œ + answers INSERT (eval_status='pending')
  â†’ fire-and-forget: process-answer í˜¸ì¶œ

[Stage A] process-answer (~70ì´ˆ)
  â†’ Whisper STT â†’ Azure ë°œìŒ í‰ê°€
  â†’ answers UPDATE (transcript, pronunciation, eval_status='stt_completed')
  â†’ fire-and-forget: evaluate-answer í˜¸ì¶œ

[Stage B] evaluate-answer (~100ì´ˆ)
  â†’ GPT-4.1 ì²´í¬ë°•ìŠ¤ í‰ê°€
  â†’ evaluations INSERT
  â†’ answers UPDATE (eval_status='completed')
  â†’ Q15 ì™„ë£Œ ì‹œ: ê·œì¹™ ì—”ì§„ ë™ê¸° ì‹¤í–‰ + generate-report fire-and-forget

[ì¬ì‹œë„ ë¡œì§] (B-2 ë°˜ì˜)
  â†’ ì‹¤íŒ¨ ì‹œ eval_retry_count++ (ìµœëŒ€ 3íšŒ)
  â†’ backoff: 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ
  â†’ ìµœì¢… ì‹¤íŒ¨: eval_status='failed' + eval_error ê¸°ë¡
```

#### ê·œì¹™ ì—”ì§„ ë“±ê¸‰ íŒì • (rule-engine.ts)

ì†Œë¦¬ë‹´ V7 ë¡œì§ ê·¸ëŒ€ë¡œ ì´ê´€:
```
Step 1: ì²´í¬ë°•ìŠ¤ ì§‘ê³„ (INT/ADV/AL í†µê³¼ìœ¨ ê³„ì‚°, ëˆ„ì  ë¡œì§ ì ìš©)
Step 2: Floor íŒì • (INT í†µê³¼ìœ¨ â†’ NH/IL/IM1/IM2/IM3)
Step 3: Ceiling íŒì • (ADV í†µê³¼ìœ¨ â†’ BROKE_DOWN/RESPOND/SUSTAIN)
Step 4: Sympathetic Listener (ë°œìŒ + ADV-5 ë³µí•© ì ìˆ˜)
Step 5: Q12 ê²Œì´íŠ¸í‚¤í¼ (ë¡¤í”Œë ˆì´ 12ë²ˆ ADV-4 í†µê³¼ìœ¨)
Step 6: AL íŒì • (AL ê²Œì´íŠ¸í‚¤í¼ + í†µê³¼ìœ¨)
Step 7: ìµœì¢… ë“±ê¸‰ ê²°í•©
```
- B-1 ë°˜ì˜: ì´ë¯¸ V7ì—ì„œ ë°±ì—”ë“œ ì²˜ë¦¬, ê·¸ëŒ€ë¡œ ìœ ì§€

#### ìƒíƒœ ëª¨ë‹ˆí„°ë§ (C-2 ë°˜ì˜)

```
í´ë§ â†’ Supabase Realtime êµ¬ë…ìœ¼ë¡œ ë³€ê²½

í”„ë¡ íŠ¸ì—”ë“œ:
  supabase.channel('mock-test-status')
    .on('postgres_changes', {
      event: 'UPDATE',
      table: 'mock_test_answers',
      filter: `session_id=eq.${sessionId}`
    }, (payload) => {
      // eval_status ë³€ê²½ ê°ì§€ â†’ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    })
    .on('postgres_changes', {
      event: 'UPDATE',
      table: 'mock_test_sessions',
      filter: `session_id=eq.${sessionId}`
    }, (payload) => {
      // holistic_status ë³€ê²½ ê°ì§€ â†’ ë¦¬í¬íŠ¸ ì™„ë£Œ ì•Œë¦¼
    })

í´ë°±: Realtime ì—°ê²° ì‹¤íŒ¨ ì‹œ 5ì´ˆ ê°„ê²© í´ë§
```

#### ì²´í¬ë°•ìŠ¤ êµ¬ì¡° ìš”ì•½

| answer_type | checkbox_type | ê°œìˆ˜ | ì ìš© ë¬¸í•­ |
|---|---|---|---|
| description | INT | 18 | ìê¸°ì†Œê°œ, ì„¤ëª…í˜• |
| routine | INT | 18 | ë£¨í‹´/ìŠµê´€ |
| roleplay_11 | INT | 20 | 11-13ë²ˆ ë¡¤í”Œë ˆì´ (+INT-3) |
| comparison | ADV | 38 | ë¹„êµ |
| past_experience | ADV | 38 | ê³¼ê±° ê²½í—˜ |
| roleplay_12 | ADV | 42 | 12ë²ˆ íŠ¹ìˆ˜ ë¡¤í”Œë ˆì´ (+ADV-4) |
| advanced_14 | AL | 6 | 14ë²ˆ ì–´ë“œë°´ìŠ¤ |
| advanced_15 | AL | 6 | 15ë²ˆ ì–´ë“œë°´ìŠ¤ |

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ ë³€ê²½ ìš”ì•½

| í•­ëª© | ì†Œë¦¬ë‹´ | ì˜¤í”½í†¡ë‹¥ |
|------|--------|----------|
| í…Œì´ë¸”ëª… | _v7 ì ‘ë¯¸ì‚¬ | ì ‘ë¯¸ì‚¬ ì—†ìŒ (B-5) |
| sessions.questions | JSONB (15ë¬¸ì œ ì „ì²´) | TEXT[] question_ids (A-6) |
| í‰ê°€ í | mock_test_queue ë³„ë„ í…Œì´ë¸” | answers.eval_status í†µí•© |
| ì¢…í•© í‰ê°€ | holistic_evaluations_v7 | mock_test_reports |
| í¬ì¸íŠ¸ ì°¨ê° | AIPermissionService í¬ì¸íŠ¸ | êµ¬ë… íšŸìˆ˜ë§Œ ì²´í¬ (B-4) |
| ìƒíƒœ ëª¨ë‹ˆí„°ë§ | 2ì´ˆ í´ë§ | Supabase Realtime + í´ë§ í´ë°± (C-2) |
| ì¬ì‹œë„ | ê¸°ë³¸ retry | backoff 1â†’2â†’4ì´ˆ, ìµœëŒ€ 3íšŒ, failed ê¸°ë¡ (B-2) |
| Edge Function | 18ê°œ | 1ê°œ mock-test/ (C-1) |
| ê·œì¹™ ì—”ì§„ | V7 ê·¸ëŒ€ë¡œ | ê·¸ëŒ€ë¡œ ì´ê´€ (B-1 ì´ë¯¸ ì ìš©) |

</details>

### 4ë‹¨ê³„: ìŠ¤í¬ë¦½íŠ¸ âœ… ì„¤ê³„ ì™„ë£Œ
- [x] ìŠ¤í¬ë¦½íŠ¸ + íŒ¨í‚¤ì§€ í…Œì´ë¸” ì„¤ê³„
- [x] AI ìƒì„± íë¦„ (C-3 ë°˜ì˜)
- [x] ê¶Œí•œ/í¬ì¸íŠ¸ ì²˜ë¦¬

<details>
<summary>ğŸ“‹ 4ë‹¨ê³„ ìƒì„¸ ì„¤ê³„ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>

#### í…Œì´ë¸” ì„¤ê³„ (3ê°œ)

**scripts (í†µí•© ìŠ¤í¬ë¦½íŠ¸ â€” ìŠ¤í¬ë¦½íŠ¸ ìƒì„± + íŠœí„°ë§ êµì • ê³µìœ )**
```sql
CREATE TABLE scripts (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  question_id     TEXT NOT NULL REFERENCES master_questions(question_id),
  source          TEXT NOT NULL DEFAULT 'generate' CHECK (source IN ('generate','correct')),
  title           TEXT,
  english_text    TEXT NOT NULL,
  korean_translation TEXT,
  sentence_data   JSONB,             -- [{index, english, korean, paragraph}]
  total_slots     SMALLINT,          -- ìŠ¬ë¡¯ ê°œìˆ˜ (êµì • ì‹œ ìŠ¬ë¡¯ êµ¬ì¡° í™œìš©)
  slots           JSONB,             -- [{slot_function, english, korean, keywords}] íŠœí„°ë§ í›ˆë ¨ìš©
  category        TEXT,              -- topic_category ê°’
  topic           TEXT,
  question_korean TEXT,
  question_english TEXT,
  user_story      TEXT,              -- ìƒì„± ì‹œ í•œêµ­ì–´ ìŠ¤í† ë¦¬
  user_original_answer TEXT,         -- êµì • ì‹œ í•™ìŠµì ì›ë³¸ ë‹µë³€
  target_level    TEXT,
  answer_type     TEXT,
  ai_model        TEXT DEFAULT 'gpt-4.1',
  word_count      INTEGER,
  generation_time INTEGER,           -- ì´ˆ ë‹¨ìœ„
  key_expressions JSONB DEFAULT '[]',
  highlighted_script TEXT,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, question_id)      -- ì‚¬ìš©ìë‹¹ ì§ˆë¬¸ë‹¹ 1ê°œ (UPSERT)
);
```
- ì¸ë±ìŠ¤: user_id, question_id, category, source
- UNIQUE(user_id, question_id): ì¬ìƒì„±/ì¬êµì • ì‹œ ê¸°ì¡´ ë®ì–´ì“°ê¸°
- **ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆê³¼ íŠœí„°ë§ ëª¨ë“ˆì´ ë™ì¼ í…Œì´ë¸” ê³µìœ **:
  - ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìƒì„±í•œ ê²°ê³¼ â†’ íŠœí„°ë§ì—ì„œ ì¬í™œìš© (ì¬êµì • ë¶ˆí•„ìš”)
  - íŠœí„°ë§ì—ì„œ êµì •í•œ ê²°ê³¼ â†’ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì¬í™œìš© (ì¬ìƒì„± ë¶ˆí•„ìš”)
  - ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ "ë‹¤ì‹œ ë§Œë“¤ê¸°" í•  ë•Œë§Œ ìƒˆë¡œ ìƒì„±
- source='generate': ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆì—ì„œ ìƒì„± (user_story ì…ë ¥)
- source='correct': íŠœí„°ë§ì—ì„œ êµì • (user_original_answer ì…ë ¥)
- prompt_id/prompt_name ì œê±° (ë‹¨ì¼ í”„ë¡¬í”„íŠ¸ì´ë¯€ë¡œ ë¶ˆí•„ìš”)

**script_packages (TTS ìŒì„± + ì‰ë„ì‰ íƒ€ì„ìŠ¤íƒ¬í”„)**
```sql
CREATE TABLE script_packages (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID NOT NULL REFERENCES auth.users(id),
  script_id       UUID NOT NULL REFERENCES scripts(id) ON DELETE CASCADE,
  status          TEXT DEFAULT 'processing' CHECK (status IN ('processing','completed','partial','failed')),
  progress        SMALLINT DEFAULT 0,
  wav_file_path   TEXT,              -- Storage ê³µê°œ URL (TTS ìŒì„±)
  json_file_path  TEXT,              -- Storage ê³µê°œ URL (ì‰ë„ì‰ íƒ€ì„ìŠ¤íƒ¬í”„)
  timestamp_data  JSONB,             -- [{text, start, end}]
  wav_file_size   INTEGER,
  error_message   TEXT,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  completed_at    TIMESTAMPTZ
);
```
- PDF ìƒì„± ì œê±° â€” íŒ¨í‚¤ì§€ = WAV ìŒì„± + ì‰ë„ì‰ JSON (2ê°œ íŒŒì¼)
- ìŠ¤í¬ë¦½íŠ¸ ì¬ìƒì„± ì‹œ ê¸°ì¡´ íŒ¨í‚¤ì§€ + Storage íŒŒì¼ ìë™ ì‚­ì œ

**ai_prompt_templates (RCTF í˜•ì‹ í”„ë¡¬í”„íŠ¸ â€” ìŠ¤í¬ë¦½íŠ¸ + íŠœí„°ë§ ê³µìœ )**
```sql
CREATE TABLE ai_prompt_templates (
  id              SERIAL PRIMARY KEY,
  template_id     TEXT UNIQUE NOT NULL,     -- 'script_rctf', 'evaluate_level', 'evaluate_realtest'
  prompt_name     TEXT,                     -- ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ì´ë¦„
  content         TEXT NOT NULL,            -- RCTF í˜•ì‹ ì „ì²´ (â•â•â• êµ¬ë¶„ìë¡œ ì„¹ì…˜ ë¶„ë¦¬)
  model           TEXT DEFAULT 'gpt-4.1',
  temperature     NUMERIC(2,1) DEFAULT 0.7,
  max_tokens      INTEGER DEFAULT 4000,
  response_format TEXT DEFAULT 'json',
  is_active       BOOLEAN DEFAULT true,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```
- **RCTF í˜•ì‹**: `â•â•â•` êµ¬ë¶„ìë¡œ [R]Role â†’ [C]Context â†’ [T]Task â†’ [F]Format 4ì„¹ì…˜ êµ¬ë¶„
- content ì•ˆì— `${script_spec}` í”Œë ˆì´ìŠ¤í™€ë” â†’ script_specs í…Œì´ë¸”ì˜ contentê°€ ì‚½ì…ë¨
- **script_rctf**: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± + íŠœí„°ë§ ë‹µë³€ êµì •ì— **ë™ì¼ í”„ë¡¬í”„íŠ¸ 1ê°œ** ì‚¬ìš©
  - ìƒì„±: ì…ë ¥ = í•œêµ­ì–´ ìŠ¤í† ë¦¬ â†’ ì¶œë ¥ = ëª©í‘œ ë“±ê¸‰ ìŠ¬ë¡¯ êµ¬ì¡° ì˜ì–´ ìŠ¤í¬ë¦½íŠ¸
  - êµì •: ì…ë ¥ = í•™ìŠµì ë‹µë³€ â†’ ì¶œë ¥ = ëª©í‘œ ë“±ê¸‰ ìŠ¬ë¡¯ êµ¬ì¡°ë¡œ êµì •ëœ ë‹µë³€
  - ì†Œë¦¬ë‹´ì—ì„  3ê°€ì§€ ë°©ì‹(AI generator, template IL-IM2, template IM3-AL) â†’ ì˜¤í”½í†¡ë‹¥ì€ 1ê°€ì§€ë¡œ í†µì¼
  - ì†Œë¦¬ë‹´ íŠœí„°ë§ì˜ 'correct' í”„ë¡¬í”„íŠ¸(ìµœì‹  RCTF)ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- evaluate_level: Level 2/3 ìŠ¬ë¡¯ ê¸°ë°˜ í‰ê°€ | evaluate_realtest: Level 4 ì²´í¬ë°•ìŠ¤ Before/After ë¹„êµ
- **ì†Œë¦¬ë‹´ ìµœì‹  ì‹œìŠ¤í…œ(script_prompt_templates 'correct') ê¸°ë°˜**
- ë°ì´í„°: 4í–‰ (script_rctf, evaluate_level, evaluate_realtest, evaluate_shadowing)

**script_specs (ë“±ê¸‰ë³„ ìŠ¤í¬ë¦½íŠ¸ ê·œê²©ì„œ â€” 60í–‰)**
```sql
CREATE TABLE script_specs (
  id              SERIAL PRIMARY KEY,
  guide_id        TEXT UNIQUE NOT NULL,     -- 'description_IL', 'routine_IM2', 'advanced_14_AL' ë“±
  answer_type     TEXT NOT NULL,            -- 10ê°€ì§€ ë‹µë³€ ìœ í˜•
  target_level    TEXT NOT NULL,            -- IL, IM1, IM2, IM3, IH, AL
  total_slots     SMALLINT NOT NULL,        -- ë“±ê¸‰ë³„ ìŠ¬ë¡¯ ê°œìˆ˜ (IL=3, IM1=4, IM2=5, IM3=6, IH=7, AL=8+)
  content         TEXT NOT NULL,            -- Markdown í˜•ì‹ ê·œê²©ì„œ (ë¶„ëŸ‰ ê¸°ì¤€, ë‹´í™” íŒ¨í„´, ì–¸ì–´ ê¸°ì¤€, ìŠ¬ë¡¯ êµ¬ì¡°, ì˜ˆì‹œ)
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```
- 10 answer_type Ã— 6 level = **60í–‰** ì‹œë“œ ë°ì´í„° (ì†Œë¦¬ë‹´ì—ì„œ ì´ê´€)
- ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ê³¼ íŠœí„°ë§ êµì • ëª¨ë‘ ê°™ì€ ê·œê²©ì„œ ì°¸ì¡°
- í”„ë¡¬í”„íŠ¸ ì¡°í•©: `ai_prompt_templates.content` ë‚´ `${script_spec}` â†’ `script_specs.content`ë¡œ ì¹˜í™˜
- ë³€ìˆ˜ ì¹˜í™˜: `{{answer_type}}`, `{{level}}`, `{{question}}`, `{{user_story}}` ë“±

#### Edge Function êµ¬ì¡° (1ê°œ)

```
supabase/functions/scripts/
â”œâ”€â”€ index.ts                        â† ë¼ìš°íŒ…
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ generate.ts                 â† ìŠ¤í¬ë¦½íŠ¸ AI ìƒì„± (GPT-4.1)
â”‚   â”œâ”€â”€ refine.ts                   â† ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •/ì •ì œ
â”‚   â”œâ”€â”€ get.ts                      â† ìŠ¤í¬ë¦½íŠ¸ ë‹¨ê±´ ì¡°íšŒ
â”‚   â”œâ”€â”€ list.ts                     â† ë‚´ ìŠ¤í¬ë¦½íŠ¸ ëª©ë¡ + í†µê³„
â”‚   â”œâ”€â”€ delete.ts                   â† ìŠ¤í¬ë¦½íŠ¸ ì‚­ì œ (+ íŒ¨í‚¤ì§€ ì—°ì‡„)
â”‚   â”œâ”€â”€ questions-with-scripts.ts   â† ì§ˆë¬¸ ëª©ë¡ + ë³´ìœ  í˜„í™©
â”‚   â”œâ”€â”€ generate-package.ts         â† íŒ¨í‚¤ì§€ Step 1 (Gemini TTS â†’ WAV)
â”‚   â”œâ”€â”€ generate-shadowing.ts       â† íŒ¨í‚¤ì§€ Step 2 (Whisper â†’ íƒ€ì„ìŠ¤íƒ¬í”„)
â”‚   â””â”€â”€ package-status.ts           â† íŒ¨í‚¤ì§€ ìƒíƒœ ì¡°íšŒ
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ prompt-loader.ts            â† ai_prompt_templates + script_specs ë¡œë“œ/ì¡°í•©
â”‚   â”œâ”€â”€ script-cleanup.ts           â† ì¬ìƒì„± ì‹œ ê¸°ì¡´ íŒ¨í‚¤ì§€/íŒŒì¼ ì‚­ì œ
â”‚   â””â”€â”€ permission-check.ts         â† êµ¬ë… íšŸìˆ˜ ì²´í¬ (í¬ì¸íŠ¸ ì•„ë‹˜)
```

#### ìŠ¤í¬ë¦½íŠ¸ ìƒì„± í”Œë¡œìš°

```
[ì‚¬ìš©ì ì…ë ¥] question_id + target_level + user_story (ì„ íƒ)

[generate.ts]
  1. êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4: íšŸìˆ˜ì œ)
  2. master_questionsì—ì„œ ì§ˆë¬¸ ë°ì´í„° ë¡œë“œ
  3. ai_prompt_templatesì—ì„œ 'script_rctf' í”„ë¡¬í”„íŠ¸ ë¡œë“œ (ìƒì„±/êµì • ë™ì¼)
  4. script_specsì—ì„œ guide_id(answer_type_level) ê·œê²©ì„œ ë¡œë“œ
  5. RCTF í”„ë¡¬í”„íŠ¸ ì¡°í•©: ${script_spec} â†’ ê·œê²©ì„œ, {{ë³€ìˆ˜}} â†’ ì‹¤ì œ ê°’ ì¹˜í™˜
  6. GPT-4.1 í˜¸ì¶œ â†’ JSON (english, korean, sentences[])
  6. scripts UPSERT (user_id + question_id)
  7. ê¸°ì¡´ íŒ¨í‚¤ì§€ ì‚­ì œ (script-cleanup)
  â†’ ìŠ¤í¬ë¦½íŠ¸ ë°˜í™˜
```

#### íŒ¨í‚¤ì§€ ìƒì„± í”Œë¡œìš° (PDF ì œê±°)

```
[Step 1] generate-package (TTSë§Œ)
  1. scriptsì—ì„œ english_text, sentence_data ì¡°íšŒ
  2. Gemini TTS â†’ WAV (voice: Zephyr, 24kHz ëª¨ë…¸)
  3. Storage ì—…ë¡œë“œ (script-packages ë²„í‚·)
  4. script_packages INSERT (status: processing, progress: 60%)
  â†’ package_id ë°˜í™˜

[Step 2] generate-shadowing (Whisper + íƒ€ì„ìŠ¤íƒ¬í”„)
  1. WAV ë‹¤ìš´ë¡œë“œ
  2. Whisper STT (word-level timestamps)
  3. sentence_dataì™€ Whisper ë‹¨ì–´ ë§¤ì¹­ â†’ timestamp_data
  4. JSON Storage ì—…ë¡œë“œ
  5. script_packages UPDATE (status: completed, progress: 100%)
  â€» Step 2 ì‹¤íŒ¨ ì‹œ status='partial' (WAVëŠ” ìœ íš¨)
```

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ ë³€ê²½ ìš”ì•½

| í•­ëª© | ì†Œë¦¬ë‹´ | ì˜¤í”½í†¡ë‹¥ |
|------|--------|----------|
| í…Œì´ë¸”ëª… | ai_training_scripts/packages | scripts / script_packages |
| í”„ë¡¬í”„íŠ¸ | 3ê°€ì§€ ë°©ì‹ í˜¼ì¬ (AI generator, template IL-IM2, IM3-AL) | 1ê°€ì§€ í†µì¼ (script_rctf). ì†Œë¦¬ë‹´ 'correct' RCTF ê¸°ë°˜. ìƒì„±/êµì • ë™ì¼ í”„ë¡¬í”„íŠ¸ |
| íŒ¨í‚¤ì§€ êµ¬ì„± | WAV + PDF + JSON (3íŒŒì¼) | WAV + JSON (2íŒŒì¼, PDF ì œê±°) |
| ê¶Œí•œ ì²´í¬ | AIPermissionService í¬ì¸íŠ¸ 50P | êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4) |
| ìºì‹œ | ai_training_cache (24ì‹œê°„ í•´ì‹œ) | ì œê±° (UPSERTë¡œ ì¶©ë¶„) |
| ëª¨ë‹ˆí„°ë§ | usage_logs + metrics | ì œê±° (ì¶”í›„ í•„ìš” ì‹œ ì¶”ê°€) |
| Edge Function | 13ê°œ | 1ê°œ scripts/ |
| Storage ë²„í‚· | ai-training-packages | script-packages |

</details>

### 5ë‹¨ê³„: AI íŠœí„° âœ… ì„¤ê³„ ì™„ë£Œ
- [x] ì„¸ì…˜/ì§„í–‰/ì‹œë„ í…Œì´ë¸” ì„¤ê³„ (template_answers ì œê±° â†’ scripts ê³µìœ )
- [x] 4ë‹¨ê³„ í›ˆë ¨ íë¦„ (ê°œì„ : ì‰ë„ì‰ ì¶”ê°€ + ë“œë˜ê·¸ì•¤ë“œë¡­ ì œê±°)
- [x] ëª¨ì˜ê³ ì‚¬ ì—°ë™ êµ¬ì¡°
- [x] ë°˜ë³µ í•™ìŠµ + ì„±ì¥ ì¶”ì  (ì‹ ê·œ)

<details>
<summary>ğŸ“‹ 5ë‹¨ê³„ ìƒì„¸ ì„¤ê³„ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ í•µì‹¬ ê°œì„ ì‚¬í•­

1. **Level 1 ë³€ê²½**: ë“œë˜ê·¸ ì•¤ ë“œë¡­ â†’ ë“£ê³  ë”°ë¼ ì½ê¸° (Read Aloud)
2. **Level 2 ì‹ ê·œ**: ì‰ë„ì‰ (í…ìŠ¤íŠ¸ ì—†ì´ ë”°ë¼ ë§í•˜ê¸°) ì¶”ê°€
3. **Level 3 í†µí•©**: ê¸°ì¡´ Level 2+3 â†’ íŒíŠ¸ ë³´ê³  ë§í•˜ê¸°
4. **ì„¸ì…˜ ë§Œë£Œ ì œê±°**: 24ì‹œê°„ â†’ ë§Œë£Œ ì—†ìŒ, ì–¸ì œë“  ì´ì–´í•˜ê¸°
5. **ë°˜ë³µ í•™ìŠµ ì¶”ê°€**: 1ì¼â†’3ì¼â†’7ì¼ ë³µìŠµ ìŠ¤ì¼€ì¤„
6. **ì„±ì¥ ì¶”ì  ì¶”ê°€**: answer_typeë³„ ì‹œê°„ ì¶”ì´ ê·¸ë˜í”„

#### í…Œì´ë¸” ì„¤ê³„ (6ê°œ â€” scripts + ai_prompt_templates + script_specsëŠ” 4ë‹¨ê³„ì™€ ê³µìœ )

**tutoring_sessions (ì„¸ì…˜)**
```sql
CREATE TABLE tutoring_sessions (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id             UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  mock_test_session_id TEXT NOT NULL,
  target_level        TEXT,
  status              TEXT DEFAULT 'active' CHECK (status IN ('active','paused','completed')),
  total_types         SMALLINT,
  completed_types     SMALLINT DEFAULT 0,
  current_type_index  SMALLINT DEFAULT 0,
  started_at          TIMESTAMPTZ DEFAULT NOW(),
  last_activity_at    TIMESTAMPTZ,
  created_at          TIMESTAMPTZ DEFAULT NOW()
);
```
- expires_at ì œê±° â€” ë§Œë£Œ ì—†ìŒ, ì–¸ì œë“  ì´ì–´í•˜ê¸° ê°€ëŠ¥
- 'expired' ìƒíƒœ ì œê±°, 'paused' ìœ ì§€ (ì•± ë‹«ìœ¼ë©´ ìë™ ì¼ì‹œì •ì§€)

**tutoring_progress (ìœ í˜•ë³„ ì§„í–‰)**
```sql
CREATE TABLE tutoring_progress (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id          UUID NOT NULL REFERENCES tutoring_sessions(id) ON DELETE CASCADE,
  answer_type         TEXT NOT NULL,
  type_index          SMALLINT NOT NULL,
  status              TEXT DEFAULT 'pending' CHECK (status IN ('pending','in_progress','completed')),
  current_level       TEXT DEFAULT 'level1' CHECK (current_level IN ('level1','level2','level3','level4')),
  pass_count          SMALLINT DEFAULT 0,
  fail_count          SMALLINT DEFAULT 0,
  script_id           UUID,               -- scripts í…Œì´ë¸” ì°¸ì¡° (ìƒì„±/êµì • ê²°ê³¼ ê³µìœ )
  current_question_id TEXT,
  before_checkboxes   JSONB,
  after_checkboxes    JSONB,
  started_at          TIMESTAMPTZ,
  completed_at        TIMESTAMPTZ
);
```
- level ì´ë¦„ ë³€ê²½: level1(ì½ê¸°) / level2(ì‰ë„ì‰) / level3(íŒíŠ¸ ë§í•˜ê¸°) / level4(ì‹¤ì „)

**tutoring_template_answers â†’ ì œê±° (scripts í…Œì´ë¸”ë¡œ í†µí•©)**
- ê¸°ì¡´ tutoring_template_answersì˜ ì—­í• ì„ scripts í…Œì´ë¸”ì´ ëŒ€ì²´
- íŠœí„°ë§ êµì • ê²°ê³¼ â†’ scriptsì— source='correct'ë¡œ ì €ì¥
- ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ê²°ê³¼ â†’ scriptsì— source='generate'ë¡œ ì €ì¥
- **ì–‘ë°©í–¥ ì¬í™œìš©**: ê°™ì€ user_id + question_idë©´ ê¸°ì¡´ scripts ì¬ì‚¬ìš©
  - ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆì—ì„œ ì´ë¯¸ ìƒì„±í•¨ â†’ íŠœí„°ë§ì—ì„œ êµì • ë¶ˆí•„ìš”
  - íŠœí„°ë§ì—ì„œ ì´ë¯¸ êµì •í•¨ â†’ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìƒì„± ë¶ˆí•„ìš”
  - ì‚¬ìš©ìê°€ "ë‹¤ì‹œ ë§Œë“¤ê¸°" â†’ UPSERTë¡œ ë®ì–´ì“°ê¸°
- scripts.slots: ìŠ¬ë¡¯ êµ¬ì¡° (Level 3 íŒíŠ¸ ë³´ê³  ë§í•˜ê¸°ì—ì„œ í™œìš©)
- scripts.english_text: Level 1(ì½ê¸°) + Level 2(ì‰ë„ì‰) TTS ì†ŒìŠ¤ë¡œ ì‚¬ìš©

**tutoring_attempts (í›ˆë ¨ ì‹œë„)**
```sql
CREATE TABLE tutoring_attempts (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id             UUID NOT NULL REFERENCES auth.users(id),
  progress_id         UUID NOT NULL REFERENCES tutoring_progress(id) ON DELETE CASCADE,
  script_id           UUID NOT NULL REFERENCES scripts(id),
  attempt_number      SMALLINT,
  training_level      TEXT NOT NULL CHECK (training_level IN ('level1','level2','level3','level4')),
  user_answer         TEXT,
  user_audio_url      TEXT,
  score               NUMERIC(5,2),
  passed              BOOLEAN,
  total_slots         SMALLINT,
  slot_evaluations    JSONB,
  overall_score       NUMERIC(5,2),
  structure_score     NUMERIC(5,2),
  checkbox_evaluation JSONB,
  final_score         NUMERIC(5,2),
  retry_slots         JSONB,
  strengths           TEXT[],
  improvements        TEXT[],
  feedback            TEXT,
  created_at          TIMESTAMPTZ DEFAULT NOW()
);
```

**tutoring_slot_templates (ìŠ¬ë¡¯ ë¼ˆëŒ€ â€” ì‹œë“œ ë°ì´í„°)**
```sql
CREATE TABLE tutoring_slot_templates (
  id              SERIAL PRIMARY KEY,
  template_id     TEXT UNIQUE NOT NULL,
  answer_type     TEXT NOT NULL,
  template_level  TEXT NOT NULL,
  answer_type_ko  TEXT,
  total_slots     SMALLINT,
  prompt_fragment TEXT,
  is_active       BOOLEAN DEFAULT true
);
```

**ai_prompt_templates + script_specs (ìŠ¤í¬ë¦½íŠ¸ì™€ ê³µìœ  â€” 4ë‹¨ê³„ì—ì„œ ì •ì˜)**
- ë³„ë„ í…Œì´ë¸” ì—†ìŒ. 4ë‹¨ê³„ ai_prompt_templates + script_specs ê³µìœ 
- template_id='script_rctf': ë‹µë³€ êµì •ì— ì‚¬ìš© (ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ê³¼ ë™ì¼í•œ í”„ë¡¬í”„íŠ¸, ì…ë ¥ë§Œ ë‹¤ë¦„)
- template_id='evaluate_level': Level 2/3 ìŠ¬ë¡¯ë³„ í‰ê°€
- template_id='evaluate_realtest': Level 4 ì²´í¬ë°•ìŠ¤ Before/After ë¹„êµ í‰ê°€

**tutoring_review_schedule (ë°˜ë³µ í•™ìŠµ ìŠ¤ì¼€ì¤„ â€” ì‹ ê·œ)**
```sql
CREATE TABLE tutoring_review_schedule (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  progress_id     UUID NOT NULL REFERENCES tutoring_progress(id) ON DELETE CASCADE,
  answer_type     TEXT NOT NULL,
  next_review_at  TIMESTAMPTZ NOT NULL,
  review_count    SMALLINT DEFAULT 0,
  interval_days   SMALLINT DEFAULT 1,
  status          TEXT DEFAULT 'scheduled' CHECK (status IN ('scheduled','completed','skipped')),
  created_at      TIMESTAMPTZ DEFAULT NOW()
);
```
- Real Test í†µê³¼ ì‹œ ìë™ ìƒì„±: 1ì¼ â†’ 3ì¼ â†’ 7ì¼ ê°„ê²©
- ë³µìŠµì€ Level 3(íŒíŠ¸ ë³´ê³  ë§í•˜ê¸°)ë¶€í„° ì‹œì‘
- ëŒ€ì‹œë³´ë“œì—ì„œ "ì˜¤ëŠ˜ ë³µìŠµí•  ìœ í˜•" ì•Œë¦¼ í‘œì‹œ

**tutoring_skill_history (ì„±ì¥ ì¶”ì  â€” ì‹ ê·œ)**
```sql
CREATE TABLE tutoring_skill_history (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  answer_type     TEXT NOT NULL,
  mock_test_session_id TEXT,
  pass_rate       NUMERIC(5,4),
  tested_at       TIMESTAMPTZ DEFAULT NOW()
);
```
- ëª¨ì˜ê³ ì‚¬ ë³¼ ë•Œë§ˆë‹¤ ìë™ ê¸°ë¡
- "comparison: 30% â†’ 55% â†’ 70%" ì‹œê°„ ì¶”ì´ ê·¸ë˜í”„ í‘œì‹œ

#### Edge Function êµ¬ì¡° (1ê°œ)

```
supabase/functions/tutoring/
â”œâ”€â”€ index.ts                            â† ë¼ìš°íŒ…
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ start.ts                        â† ì„¸ì…˜ ì‹œì‘ (ì•½ì  ë¶„ì„ â†’ progress ìƒì„±)
â”‚   â”œâ”€â”€ get-diagnosis.ts                â† ì§„ë‹¨ ê²°ê³¼ ì¡°íšŒ
â”‚   â”œâ”€â”€ get-progress.ts                 â† ì§„í–‰ ìƒíƒœ ì¡°íšŒ
â”‚   â”œâ”€â”€ get-original-answer.ts          â† ëª¨ì˜ê³ ì‚¬ ì›ë³¸ ë‹µë³€ ì¡°íšŒ
â”‚   â”œâ”€â”€ generate-corrected-script.ts    â† AI êµì • â†’ scripts UPSERT (ì—†ì„ ë•Œë§Œ, ìˆìœ¼ë©´ ì¬í™œìš©)
â”‚   â”œâ”€â”€ evaluate-attempt.ts             â† í›ˆë ¨ ì‹œë„ í‰ê°€ (Level 1~4)
â”‚   â”œâ”€â”€ next-question.ts                â† ë‹¤ìŒ ìœ í˜• í™œì„±í™”
â”‚   â”œâ”€â”€ transcribe.ts                   â† Whisper STT
â”‚   â”œâ”€â”€ generate-tts.ts                 â† ë¬¸ì¥ë³„ TTS (Level 1, 2ìš©)
â”‚   â”œâ”€â”€ get-review-schedule.ts          â† ë³µìŠµ ìŠ¤ì¼€ì¤„ ì¡°íšŒ (ì‹ ê·œ)
â”‚   â””â”€â”€ get-skill-history.ts            â† ì„±ì¥ ì¶”ì  ì¡°íšŒ (ì‹ ê·œ)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ weakness-analyzer.ts            â† ì•½ì  ì§„ë‹¨ (pass_rate ì§‘ê³„)
â”‚   â”œâ”€â”€ prompt-loader.ts                â† ai_prompt_templates + script_specs ë¡œë“œ/ì¡°í•©
â”‚   â”œâ”€â”€ slot-evaluator.ts              â† ìŠ¬ë¡¯ë³„ í‰ê°€ ë¡œì§
â”‚   â””â”€â”€ review-scheduler.ts            â† ë³µìŠµ ìŠ¤ì¼€ì¤„ ìƒì„± (1â†’3â†’7ì¼)
```

#### 4ë‹¨ê³„ í›ˆë ¨ í”Œë¡œìš° (ê°œì„ ì•ˆ)

```
[ì„¸ì…˜ ì‹œì‘] start.ts
  â†’ mock_test_evaluationsì—ì„œ answer_typeë³„ pass_rate ì§‘ê³„
  â†’ ì ìˆ˜ ë‚®ì€ ìˆœ ì •ë ¬ â†’ tutoring_sessions + progress ìƒì„±
  â†’ tutoring_skill_historyì— í˜„ì¬ pass_rate ê¸°ë¡

[ì§„ë‹¨] get-diagnosis
  â†’ ìš°ì„ ìˆœìœ„ ìœ í˜• + ì•½ì  ì²´í¬ë°•ìŠ¤ + ì„±ì¥ ì¶”ì´ í‘œì‹œ

[í›ˆë ¨ ì¤€ë¹„]
  â†’ get-original-answer: ìµœì € pass_rate ë¬¸í•­ ì„ íƒ
  â†’ scripts í…Œì´ë¸” ì¡°íšŒ: í•´ë‹¹ user_id + question_idì— ì´ë¯¸ ìŠ¤í¬ë¦½íŠ¸ ìˆëŠ”ì§€ í™•ì¸
  â†’ ìˆìœ¼ë©´ ì¬í™œìš© (ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆì—ì„œ ì´ë¯¸ ìƒì„±í•œ ê²ƒ í¬í•¨)
  â†’ ì—†ìœ¼ë©´ generate-corrected-script: GPT-4.1 RCTF â†’ scriptsì— source='correct'ë¡œ UPSERT

[Level 1] ë“£ê³  ë”°ë¼ ì½ê¸° (Read Aloud)
  â†’ êµì • ë‹µë³€ í…ìŠ¤íŠ¸ í‘œì‹œ + TTS ë¬¸ì¥ë³„ ì¬ìƒ
  â†’ ì‚¬ìš©ìê°€ ë¬¸ì¥ë³„ë¡œ ë”°ë¼ ì½ê¸° â†’ ë…¹ìŒ â†’ ë°œìŒ í‰ê°€
  â†’ ì™„ë£Œ ì‹œ â†’ Level 2

[Level 2] ì‰ë„ì‰ (Shadowing)
  â†’ í…ìŠ¤íŠ¸ ìˆ¨ê¹€, TTS ë¬¸ì¥ë³„ ì¬ìƒë§Œ
  â†’ ë“¤ì€ ì§í›„ ë”°ë¼ ë§í•˜ê¸° â†’ STT â†’ ìœ ì‚¬ë„ í‰ê°€
  â†’ score â‰¥ 70 í†µê³¼ â†’ Level 3 | ì‹¤íŒ¨ â†’ Level 2 ì¬ì‹œë„

[Level 3] íŒíŠ¸ ë³´ê³  ë§í•˜ê¸° (Guided Speaking)
  â†’ slot_function + keywordsë§Œ í‘œì‹œ (ìŒì„±/í…ìŠ¤íŠ¸ ì—†ìŒ)
  â†’ ê¸°ì–µ ë”ë“¬ì–´ ë§í•˜ê¸° â†’ STT â†’ GPT-4.1 í‰ê°€
  â†’ í†µê³¼ â†’ Level 4 | ì‹¤íŒ¨ â†’ Level 2 ë³µê·€

[Level 4] ì‹¤ì „ í…ŒìŠ¤íŠ¸ (Real Test)
  â†’ ì§ˆë¬¸ë§Œ í‘œì‹œ, ëª¨ë“  íŒíŠ¸ ì œê±°
  â†’ ë…¹ìŒ â†’ STT â†’ GPT-4.1 ì²´í¬ë°•ìŠ¤ Before/After ë¹„êµ
  â†’ í†µê³¼: progress completed + ë³µìŠµ ìŠ¤ì¼€ì¤„ ìƒì„±
  â†’ ì‹¤íŒ¨: Level 2 ë³µê·€

[ë³µìŠµ] review-scheduler
  â†’ Real Test í†µê³¼ 1ì¼ í›„: Level 3ë¶€í„° ì¬ì‹œì‘
  â†’ 3ì¼ í›„: Level 3ë¶€í„°
  â†’ 7ì¼ í›„: Level 4ë§Œ
  â†’ ë³µìŠµ ì™„ë£Œ ì‹œ interval_days * 2ë¡œ ë‹¤ìŒ ë³µìŠµ ìƒì„± (ìµœëŒ€ 30ì¼)
```

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ ë³€ê²½ ìš”ì•½

| í•­ëª© | ì†Œë¦¬ë‹´ | ì˜¤í”½í†¡ë‹¥ |
|------|--------|----------|
| êµì • ë‹µë³€ ì €ì¥ | tutoring_template_answers (íŠœí„°ë§ ì „ìš©) | scripts í…Œì´ë¸” ê³µìœ  (source='correct') |
| ìŠ¤í¬ë¦½íŠ¸ ì—°ë™ | ì—†ìŒ (ë³„ë„) | ì–‘ë°©í–¥ ì¬í™œìš© â€” ì´ë¯¸ ìˆìœ¼ë©´ ì¬ì‚¬ìš©, ì—†ì„ ë•Œë§Œ ìƒì„± |
| Level 1 | ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ì½ê¸° ê²Œì„) | ë“£ê³  ë”°ë¼ ì½ê¸° (ë°œìŒ ì—°ìŠµ) |
| Level 2 | í‚¤ì›Œë“œ ë³´ê³  ë§í•˜ê¸° | ì‰ë„ì‰ (í…ìŠ¤íŠ¸ ì—†ì´ ë”°ë¼ ë§í•˜ê¸°) |
| Level 3 | ê¸°ëŠ¥ë§Œ ë³´ê³  ë§í•˜ê¸° | íŒíŠ¸ ë³´ê³  ë§í•˜ê¸° (L2+L3 í†µí•©) |
| Level 4 | Real Test | Real Test (ë™ì¼) |
| ì„¸ì…˜ ë§Œë£Œ | 24ì‹œê°„ | ë§Œë£Œ ì—†ìŒ |
| ë°˜ë³µ í•™ìŠµ | ì—†ìŒ | 1ì¼â†’3ì¼â†’7ì¼â†’14ì¼ ë³µìŠµ ìŠ¤ì¼€ì¤„ |
| ì„±ì¥ ì¶”ì  | ì—†ìŒ | answer_typeë³„ pass_rate ì‹œê°„ ì¶”ì´ |
| ë²„ì „ | V1/V2/V3 ë³‘ì¡´ | ë‹¨ì¼ ë²„ì „ (í•µì‹¬ë§Œ) |
| í…Œì´ë¸” | 12+ (V2/V3 í¬í•¨) | 8ê°œ |
| Edge Function | 10ê°œ + ìœ í‹¸ 20ê°œ+ | 1ê°œ tutoring/ |
| í¬ì¸íŠ¸ | AIPermissionService 50P | êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4) |

</details>

### 6ë‹¨ê³„: ì‰ë„ì‰ âœ… ì„¤ê³„ ì™„ë£Œ
- [x] ì„¸ì…˜/í‰ê°€ í…Œì´ë¸” ì„¤ê³„
- [x] 4ëª¨ë“œ êµ¬ì¡° (Listen/Training/Assessment/Real Test)
- [x] íƒ€ì„ìŠ¤íƒ¬í”„ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ (Levenshtein + ê°­ ë³´ì •)
- [x] scripts/ Edge Functionì— í†µí•©

<details>
<summary>ğŸ“‹ 6ë‹¨ê³„ ìƒì„¸ ì„¤ê³„ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>

#### ì‰ë„ì‰ì˜ ìœ„ì¹˜

ì‰ë„ì‰ì€ **ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆì˜ í•˜ìœ„ ê¸°ëŠ¥**ì´ë‹¤.
- ë„¤ë¹„ê²Œì´ì…˜: ìŠ¤í¬ë¦½íŠ¸ íƒ­ â†’ "ì‰ë„ì‰ í›ˆë ¨" íƒ­
- ìŠ¤í¬ë¦½íŠ¸ ìƒì„± â†’ íŒ¨í‚¤ì§€ ìƒì„±(WAV+JSON) â†’ **ì‰ë„ì‰ì—ì„œ ì†Œë¹„**
- AI íŠœí„° Level 2ë„ ì‰ë„ì‰ì´ì§€ë§Œ, íŠœí„°ë§ ì»¨í…ìŠ¤íŠ¸(êµì • ë‹µë³€ ê¸°ë°˜)ì´ë¯€ë¡œ ë³„ë„ íë¦„

#### ì‰ë„ì‰ vs íŠœí„°ë§ Level 2 ì°¨ì´

| êµ¬ë¶„ | ì‰ë„ì‰ (ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆ) | íŠœí„°ë§ Level 2 |
|------|----------------------|---------------|
| ì§„ì… | ë‚´ ìŠ¤í¬ë¦½íŠ¸ ì„ íƒ â†’ ì‰ë„ì‰ | ëª¨ì˜ê³ ì‚¬ â†’ ì§„ë‹¨ â†’ êµì • ë‹µë³€ ìƒì„± í›„ |
| ì†ŒìŠ¤ | ì‚¬ìš©ìê°€ ë§Œë“  ìŠ¤í¬ë¦½íŠ¸ | AIê°€ êµì •í•œ template_answer |
| ëª¨ë“œ | 4ê°€ì§€ (Listen/Training/Assessment/Real Test) | ì‰ë„ì‰ë§Œ (í…ìŠ¤íŠ¸ ì—†ì´ ë”°ë¼ ë§í•˜ê¸°) |
| í‰ê°€ | GPT 5ì˜ì—­ ìƒì„¸ í‰ê°€ (pronunciation/fluency/grammar/vocabulary/content) | ìœ ì‚¬ë„ í‰ê°€ (score â‰¥ 70 í†µê³¼) |
| DB | shadowing_sessions + shadowing_evaluations | tutoring_attempts (training_level='level2') |
| ê²°ê³¼ | OPIc ë“±ê¸‰ ì¶”ì • + ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„ | í†µê³¼/ë¶ˆí†µê³¼ â†’ Level 3 ì§„í–‰ |

#### í…Œì´ë¸” ì„¤ê³„ (2ê°œ â€” script_packagesëŠ” 4ë‹¨ê³„ì—ì„œ ì •ì˜ë¨)

**shadowing_sessions (í…ŒìŠ¤íŠ¸/í‰ê°€ ì„¸ì…˜)**
```sql
CREATE TABLE shadowing_sessions (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id         UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  package_id      UUID NOT NULL REFERENCES script_packages(id) ON DELETE CASCADE,
  script_id       UUID NOT NULL REFERENCES scripts(id) ON DELETE CASCADE,
  question_text   TEXT,                     -- ì˜ë¬¸ ì§ˆë¬¸
  question_korean TEXT,                     -- í•œê¸€ ì§ˆë¬¸
  topic           TEXT,
  mode            TEXT NOT NULL CHECK (mode IN ('assessment','realtest')),
  status          TEXT DEFAULT 'active' CHECK (status IN ('active','completed')),
  audio_duration  NUMERIC(8,2),             -- ë…¹ìŒ ê¸¸ì´ (ì´ˆ)
  started_at      TIMESTAMPTZ DEFAULT NOW(),
  completed_at    TIMESTAMPTZ
);
```
- Listen/Training ëª¨ë“œëŠ” DB ë¶ˆí•„ìš” (í´ë¼ì´ì–¸íŠ¸ ì™„ê²°)
- Assessment/Real Testë§Œ ì„¸ì…˜ ìƒì„±
- expires_at ì œê±° (ì„¸ì…˜ ë§Œë£Œ ì—†ìŒ)
- í¬ì¸íŠ¸ ê´€ë ¨ ì»¬ëŸ¼ ì œê±° (B-4 íšŸìˆ˜ì œ)

**shadowing_evaluations (AI í‰ê°€ ê²°ê³¼)**
```sql
CREATE TABLE shadowing_evaluations (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id          UUID NOT NULL REFERENCES shadowing_sessions(id) ON DELETE CASCADE,
  user_id             UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  transcript          TEXT NOT NULL,         -- Whisper STT ê²°ê³¼
  word_count          INTEGER,

  -- 5ì˜ì—­ ì ìˆ˜ (5ì  ë§Œì )
  pronunciation       NUMERIC(3,1),          -- ë°œìŒ
  fluency             NUMERIC(3,1),          -- ìœ ì°½ì„±
  grammar             NUMERIC(3,1),          -- ë¬¸ë²•
  vocabulary          NUMERIC(3,1),          -- ì–´íœ˜
  content_score       NUMERIC(3,1),          -- ë‚´ìš© (contentëŠ” ì˜ˆì•½ì–´ íšŒí”¼)
  overall_score       NUMERIC(5,1),          -- ì´ì  (0-100)
  estimated_level     TEXT,                  -- OPIc ë“±ê¸‰ ì¶”ì • (IL~AL)
  script_utilization  NUMERIC(5,1),          -- ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„ (0-100)

  -- AI í”¼ë“œë°±
  strengths           TEXT[],                -- ê°•ì 
  weaknesses          TEXT[],                -- ì•½ì 
  suggestions         TEXT[],                -- ê°œì„  ì œì•ˆ
  script_analysis     JSONB,                 -- {key_sentences_used, key_vocabulary_used, missing_elements}

  created_at          TIMESTAMPTZ DEFAULT NOW()
);
```
- ì†Œë¦¬ë‹´ì˜ usage_method, points_used ì œê±° (íšŸìˆ˜ì œ)
- ai_response ì›ë³¸ ì €ì¥ ì œê±° (ë¹„ìš© ì ˆê°)

#### 4ê°€ì§€ ëª¨ë“œ

**1. Listen Mode (ì „ì²´ ë“£ê¸°)** â€” í´ë¼ì´ì–¸íŠ¸ ì™„ê²°
```
[ë°ì´í„° ë¡œë“œ]
  script_packagesì—ì„œ WAV URL + JSON URL ì¡°íšŒ
  JSONì—ì„œ shadowing_sentences íŒŒì‹±

[ì¬ìƒ]
  WAV ì „ì²´ ì¬ìƒ
  currentTime ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ë¬¸ì¥ í•˜ì´ë¼ì´íŠ¸
  0.5x ~ 2.0x ì†ë„ ì¡°ì ˆ
  ì˜ë¬¸/í•œê¸€/ë‘˜ ë‹¤ í‘œì‹œ ì „í™˜
  ìë™ ìŠ¤í¬ë¡¤
```
- DB í˜¸ì¶œ ì—†ìŒ, API í˜¸ì¶œ ì—†ìŒ
- Zustand ë¡œì»¬ ìƒíƒœ ê´€ë¦¬

**2. Training Mode (ë¬¸ì¥ë³„ í›ˆë ¨)** â€” í´ë¼ì´ì–¸íŠ¸ ì™„ê²°
```
[ë¬¸ì¥ ì„ íƒ]
  ë¬¸ì¥ ëª©ë¡ì—ì„œ í›ˆë ¨í•  ë¬¸ì¥ ì„ íƒ (ë˜ëŠ” ìˆœì°¨ ì§„í–‰)

[í›ˆë ¨ ë£¨í”„]
  1. í•´ë‹¹ ë¬¸ì¥ êµ¬ê°„ë§Œ ì˜¤ë””ì˜¤ ì¬ìƒ
  2. ì‚¬ìš©ì ë”°ë¼ ì½ê¸° â†’ ë…¹ìŒ
  3. í´ë¼ì´ì–¸íŠ¸ ë°œìŒ ë¹„êµ (Web Speech API ë˜ëŠ” ë‹¨ìˆœ ì™„ë£Œ í™•ì¸)
  4. ì—°ìŠµ íšŸìˆ˜ ì¹´ìš´íŠ¸ (localStorage)
  5. ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ì´ë™

[ë°˜ë³µ ì„¤ì •]
  êµ¬ê°„ ë°˜ë³µ (A-B repeat)
  ë¬¸ì¥ ê°„ ì¼ì‹œì •ì§€ ì‹œê°„ ì¡°ì ˆ
```
- DB í˜¸ì¶œ ì—†ìŒ, í¬ì¸íŠ¸ ì†Œë¹„ ì—†ìŒ
- ì§„ë„ ì¶”ì ì€ localStorage (Zustand persist)

**3. Assessment Mode (ì‚¬ì „ í‰ê°€)** â€” API í˜¸ì¶œ
```
[ë…¹ìŒ]
  ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ 1íšŒ ì½ê¸° â†’ ë…¹ìŒ

[í‰ê°€] shadowing-evaluate.ts
  1. êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4)
  2. Whisper STT (í…ìŠ¤íŠ¸ ë³€í™˜)
  3. ë°œí™” ê¸¸ì´ ê²€ì¦ (ìµœì†Œ 5ë‹¨ì–´)
  4. ai_prompt_templatesì—ì„œ 'evaluate_shadowing' í”„ë¡¬í”„íŠ¸ ë¡œë“œ
  5. GPT-4.1 í‰ê°€ (5ì˜ì—­ + OPIc ë“±ê¸‰ + ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„)
  6. shadowing_sessions (mode='assessment') + shadowing_evaluations ì €ì¥

[ê²°ê³¼]
  5ì˜ì—­ ë ˆì´ë” ì°¨íŠ¸ + ë“±ê¸‰ + ë§ì¶¤ í›ˆë ¨ ê°€ì´ë“œ
```

**4. Real Test Mode (ì‹¤ì „ í…ŒìŠ¤íŠ¸)** â€” API í˜¸ì¶œ
```
[ì¤€ë¹„]
  ìŠ¤í¬ë¦½íŠ¸ í…ìŠ¤íŠ¸ ì™„ì „ ìˆ¨ê¹€ (ì§ˆë¬¸ë§Œ í‘œì‹œ)

[ë…¹ìŒ]
  ììœ  ë‹µë³€ ë…¹ìŒ

[í‰ê°€] ë™ì¼ shadowing-evaluate.ts (mode='realtest')
  â†’ Assessmentì™€ ë™ì¼í•œ íŒŒì´í”„ë¼ì¸
  â†’ Real TestëŠ” script_utilization ê°€ì¤‘ì¹˜ ë” ë†’ìŒ

[ê²°ê³¼]
  5ì˜ì—­ + ë“±ê¸‰ + ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„ ë¶„ì„
  ì´ì „ í‰ê°€ ëŒ€ë¹„ ë³€í™” í‘œì‹œ
```

#### ai_prompt_templatesì— ì¶”ê°€ (1í–‰)

```sql
INSERT INTO ai_prompt_templates (template_id, mode, prompt_name, content, model, max_tokens) VALUES
('evaluate_shadowing', 'evaluate', 'ì‰ë„ì‰ í‰ê°€', '...RCTF í˜•ì‹...', 'gpt-4.1', 2000);
```
- ë³€ìˆ˜: `{{question_text}}`, `{{transcript}}`, `{{training_script}}`, `{{key_expressions}}`
- ì¶œë ¥: JSON (pronunciation, fluency, grammar, vocabulary, content, overall_score, estimated_level, script_utilization, strengths, weaknesses, suggestions, script_analysis)

#### Edge Function êµ¬ì¡° (scripts/ ì— í†µí•©)

```
supabase/functions/scripts/
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ ... (ê¸°ì¡´ 4ë‹¨ê³„ í•¸ë“¤ëŸ¬)
â”‚   â”œâ”€â”€ shadowing-session-create.ts   â† ì„¸ì…˜ ìƒì„± (assessment/realtest)
â”‚   â”œâ”€â”€ shadowing-evaluate.ts         â† Whisper STT + GPT í‰ê°€
â”‚   â””â”€â”€ shadowing-history.ts          â† í‰ê°€ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ ... (ê¸°ì¡´ ìœ í‹¸)
â”‚   â””â”€â”€ sentence-matcher.ts           â† Levenshtein ë§¤ì¹­ + ê°­ ë³´ì •
```

#### íƒ€ì„ìŠ¤íƒ¬í”„ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ (íŒ¨í‚¤ì§€ ìƒì„± ì‹œ)

íŒ¨í‚¤ì§€ ìƒì„± Step 2 (`generate-shadowing.ts`)ì—ì„œ ì‹¤í–‰:

```
[ì…ë ¥]
  - WAV íŒŒì¼ (Storageì—ì„œ ë‹¤ìš´ë¡œë“œ)
  - sentence_data (scripts í…Œì´ë¸”ì—ì„œ ì¡°íšŒ)

[Step 1] Whisper word-level STT
  â†’ response_format='verbose_json', timestamp_granularities=['word']
  â†’ {text, words: [{word, start, end}, ...]}

[Step 2] ë¬¸ì¥-ë‹¨ì–´ ë§¤ì¹­ (sentence-matcher.ts)
  â†’ ê° GPT ë¬¸ì¥ì„ Whisper ë‹¨ì–´ ë°°ì—´ì—ì„œ ìŠ¬ë¼ì´ë”© ìœˆë„ìš°ë¡œ ê²€ìƒ‰
  â†’ í…ìŠ¤íŠ¸ ì •ê·œí™”: ì†Œë¬¸ì + êµ¬ë‘ì  ì œê±° + ì•„í¬ìŠ¤íŠ¸ë¡œí”¼ ì œê±°
  â†’ Levenshtein Distance ìœ ì‚¬ë„ ê³„ì‚°
  â†’ ê°€ì¥ ë†’ì€ ìœ ì‚¬ë„ ìœ„ì¹˜ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ì¶œ

[Step 3] ê°­ ë³´ì • (fillTimestampGaps)
  â†’ ë¬¸ì¥ ê°„ ê°­ > 0.5ì´ˆ â†’ ì¤‘ê°„ê°’ìœ¼ë¡œ ì¡°ì •
  â†’ ì˜¤ë²„ë© â†’ ê²½ê³„ë¥¼ ì¤‘ê°„ê°’ìœ¼ë¡œ ì¡°ì •

[Step 4] JSON ìƒì„± + Storage ì—…ë¡œë“œ
  â†’ {script_id, shadowing_sentences: [{index, english, korean, start, end, duration}], metadata}
  â†’ script_packages ì—…ë°ì´íŠ¸ (json_url, status='completed')
```

#### ì‰ë„ì‰ JSON íŒŒì¼ êµ¬ì¡°

```json
{
  "script_id": "uuid",
  "shadowing_sentences": [
    {
      "index": 0,
      "english": "I usually go to the park on weekends.",
      "korean": "ë‚˜ëŠ” ë³´í†µ ì£¼ë§ì— ê³µì›ì— ê°€ìš”.",
      "start": 0.10,
      "end": 1.85,
      "duration": 1750
    }
  ],
  "metadata": {
    "word_level_matching": true,
    "sentence_count": 5,
    "generated_at": "2026-02-20T..."
  }
}
```

#### í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ (Zustand)

```typescript
// useShadowingStore
interface ShadowingState {
  // ë°ì´í„°
  packageId: string | null;
  sentences: ShadowingSentence[];
  audioUrl: string | null;

  // ì¬ìƒ
  currentIndex: number;
  isPlaying: boolean;
  playbackRate: number;           // 0.5 ~ 2.0
  displayMode: 'both' | 'english' | 'korean';
  currentTime: number;

  // ë°˜ë³µ
  repeatMode: 'none' | 'current' | 'all' | 'ab';
  pauseBetweenSentences: number;  // ì´ˆ
  abRepeatStart: number | null;
  abRepeatEnd: number | null;

  // ì§„ë„ (localStorage persist)
  completedSentences: Set<number>;
  practiceCount: Map<number, number>;
}
```

#### ì†Œë¦¬ë‹´ ëŒ€ë¹„ ë³€ê²½ ìš”ì•½

| í•­ëª© | ì†Œë¦¬ë‹´ | ì˜¤í”½í†¡ë‹¥ |
|------|--------|----------|
| í…Œì´ë¸”ëª… | shadowing_test_sessions / evaluations | shadowing_sessions / evaluations |
| ì„¸ì…˜ ë§Œë£Œ | 24ì‹œê°„ (expires_at) | ë§Œë£Œ ì—†ìŒ |
| ëª¨ë“œ | 4ê°€ì§€ (Listen/Training/Assessment/Real Test) | ë™ì¼ 4ê°€ì§€ |
| í‰ê°€ êµ¬ì¡° | 5ì˜ì—­ + OPIc ë“±ê¸‰ + ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„ | ë™ì¼ |
| í¬ì¸íŠ¸ | 10P/íšŒ + í™˜ë¶ˆ ë¡œì§ | êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4) |
| í”„ë¡¬í”„íŠ¸ | admin_prompts (feature_type='shadowing_test') | ai_prompt_templates (template_id='evaluate_shadowing') |
| Edge Function | 3ê°œ ë³„ë„ í•¨ìˆ˜ | scripts/ í•˜ìœ„ í•¸ë“¤ëŸ¬ 3ê°œ í†µí•© |
| íŒ¨í‚¤ì§€ | ai_training_packages (PDF+WAV+JSON) | script_packages (WAV+JSON, PDF ì œê±°) |
| í”„ë¡ íŠ¸ì—”ë“œ | shadowingService SOLID íŒ¨í„´ | ë™ì¼ íŒ¨í„´ ìœ ì§€ |
| íƒ€ì„ìŠ¤íƒ¬í”„ ë§¤ì¹­ | Levenshtein + ê°­ ë³´ì • | ë™ì¼ ì•Œê³ ë¦¬ì¦˜ ì´ê´€ |

</details>

---

## ê²°ì • ê¸°ë¡

> ë…¼ì˜ë¥¼ í†µí•´ í•©ì˜ëœ ë‚´ìš©ì„ ì—¬ê¸°ì— ê¸°ë¡

### ê³µí†µ ê¸°ë°˜
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| ENUM ì‚¬ìš© | master_questionsì— ì ìš© ì™„ë£Œ (survey_type, topic_category, answer_type) | 2026-02-20 |
| í…Œì´ë¸” ë²„ì „ ì ‘ë¯¸ì‚¬ | ì˜¤í”½í†¡ë‹¥ì€ v ì ‘ë¯¸ì‚¬ ì—†ì´ ì§„í–‰ | 2026-02-20 |
| DB timezone | Asia/Seoul ì„¤ì • ì™„ë£Œ | 2026-02-20 |
| FK ì „ëµ | ë‹¨ì¼ ê°’ ì°¸ì¡° = FK í•„ìˆ˜, ë°°ì—´(TEXT[]) + ë¶ˆë³€ ë°ì´í„° = ë°°ì—´ ìœ ì§€ FK ìƒëµ, ì‚­ì œ ì •ì±…: ì¢…ì†=CASCADE / ë³´í˜¸=RESTRICT | 2026-02-20 |
| ENUM/CHECK ì „ëµ | ê°’ í™•ì • = ENUM, í–¥í›„ ë³€ê²½ ê°€ëŠ¥ = CHECK ì œì•½ ì¡°ê±´ | 2026-02-20 |
| íŠ¸ë¦¬ê±° ì›ì¹™ | íŠ¸ë¦¬ê±°ëŠ” ë‹¨ìˆœ ì‘ì—…ë§Œ (updated_at, user_sync). ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Edge Functionìœ¼ë¡œ ì´ì „ | 2026-02-20 |
| CORS ì •ì±… | opictalkdoc.com + www + localhost:3000ë§Œ í—ˆìš©, ë‚˜ë¨¸ì§€ ì°¨ë‹¨ | 2026-02-20 |
| í¬ì¸íŠ¸ ì‹œìŠ¤í…œ | ì‚­ì œ. íšŸìˆ˜ì œë¡œ ì „í™˜ (í”Œëœë³„ ì‚¬ìš© íšŸìˆ˜ ì œí•œ, êµ¬ë… í…Œì´ë¸”ì—ì„œ ê´€ë¦¬) | 2026-02-20 |
| Edge Function êµ¬ì¡° | ëª¨ë“ˆë³„ 1ê°œ í•¨ìˆ˜ + handlers/ íŒŒì¼ ë¶„ë¦¬ + _shared/ ê³µí†µ ì½”ë“œ. 44ê°œ â†’ 6~8ê°œ í†µí•© | 2026-02-20 |

### ì‹œí—˜í›„ê¸°
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| í…Œì´ë¸” êµ¬ì¡° | submissions + submission_questions + submission_combos (3ê°œ). custom_mode_questions ì œê±° | 2026-02-20 |
| ì½¤ë³´ ìƒì„± | DB íŠ¸ë¦¬ê±° ì œê±°, Edge Function(combo-extractor.ts)ì—ì„œ Step 3 ì™„ë£Œ ì‹œ ìƒì„± | 2026-02-20 |
| ë¹ˆë„ ë¶„ì„ | frequency ì»¬ëŸ¼ ì œê±°, GROUP BY COUNT(*)ë¡œ ì‹¤ì‹œê°„ ê³„ì‚° | 2026-02-20 |
| Edge Function | submissions(ì“°ê¸°) + analysis(ì½ê¸°) 2ê°œë¡œ í†µí•©. ë‚´ë¶€ handlers/ í´ë”ë¡œ ë¶„ë¦¬ | 2026-02-20 |
| í¬ì¸íŠ¸ ì§€ê¸‰ | ì œê±° (B-4 íšŸìˆ˜ì œ ì „í™˜ ë°˜ì˜) | 2026-02-20 |

### ëª¨ì˜ê³ ì‚¬
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| í…Œì´ë¸” êµ¬ì¡° | mock_test_sessions + answers + evaluations + reports + eval_settings (5ê°œ). queue í…Œì´ë¸”ì€ answersì— í†µí•© | 2026-02-20 |
| sessions.questions | JSONB â†’ question_ids TEXT[] (A-6), master_questions JOINìœ¼ë¡œ ì¡°íšŒ | 2026-02-20 |
| í‰ê°€ ì•„í‚¤í…ì²˜ | V7 2ë‹¨ê³„ ìœ ì§€: Stage A(STT+Azure) â†’ Stage B(GPT-4.1 ì²´í¬ë°•ìŠ¤) fire-and-forget | 2026-02-20 |
| ê·œì¹™ ì—”ì§„ | V7 ê·¸ëŒ€ë¡œ ì´ê´€ â€” Floor/Ceiling/AL 7ë‹¨ê³„ íŒì • (B-1 ì´ë¯¸ ë°±ì—”ë“œ) | 2026-02-20 |
| ì¬ì‹œë„ íŒ¨í„´ | eval_retry_count + report_retry_count, ìµœëŒ€ 3íšŒ, backoff 1â†’2â†’4ì´ˆ (B-2) | 2026-02-20 |
| ìƒíƒœ ëª¨ë‹ˆí„°ë§ | Supabase Realtime êµ¬ë… + í´ë§ í´ë°± (C-2) | 2026-02-20 |
| Edge Function | 18ê°œ â†’ 1ê°œ mock-test/ (C-1) | 2026-02-20 |

### ìŠ¤í¬ë¦½íŠ¸
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| í…Œì´ë¸” êµ¬ì¡° | scripts(í†µí•©) + script_packages (2ê°œ) + ai_prompt_templates + script_specs (ê³µìœ  2ê°œ). ìºì‹œ/ëª¨ë‹ˆí„°ë§ í…Œì´ë¸” ì œê±° | 2026-02-20 |
| scripts í†µí•© | scripts í…Œì´ë¸” = ìŠ¤í¬ë¦½íŠ¸ ìƒì„± + íŠœí„°ë§ êµì • ê²°ê³¼ ê³µìœ  ì €ì¥ì†Œ. source ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ë¶„. ê°™ì€ user+questionì´ë©´ ì¬í™œìš©, ì‚¬ìš©ì ëª…ì‹œ ìš”ì²­ ì‹œë§Œ ì¬ìƒì„± | 2026-02-20 |
| íŒ¨í‚¤ì§€ êµ¬ì„± | WAV + JSON (2íŒŒì¼). PDF ìƒì„± ì œê±° | 2026-02-20 |
| í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ | ai_prompt_templates (RCTF, 4í–‰: script_rctf + evaluate 3ê°œ) + script_specs (60í–‰ ê·œê²©ì„œ). ìŠ¤í¬ë¦½íŠ¸ ìƒì„±+íŠœí„°ë§ êµì • = ë™ì¼ í”„ë¡¬í”„íŠ¸ 1ê°œ(script_rctf). ì†Œë¦¬ë‹´ 3ê°€ì§€ â†’ 1ê°€ì§€ í†µì¼ | 2026-02-20 |
| ê¶Œí•œ ì²˜ë¦¬ | í¬ì¸íŠ¸ ì°¨ê° ì œê±°, êµ¬ë… íšŸìˆ˜ ì²´í¬ (B-4) | 2026-02-20 |
| Edge Function | 13ê°œ â†’ 1ê°œ scripts/ (C-1) | 2026-02-20 |

### AI íŠœí„°
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| í…Œì´ë¸” êµ¬ì¡° | 6ê°œ: sessions + progress + attempts + slot_templates + review_schedule(ì‹ ê·œ) + skill_history(ì‹ ê·œ). template_answers ì œê±° â†’ scripts í…Œì´ë¸” ê³µìœ  | 2026-02-20 |
| í›ˆë ¨ 4ë‹¨ê³„ | L1 ë“£ê³  ë”°ë¼ ì½ê¸° â†’ L2 ì‰ë„ì‰(ì‹ ê·œ) â†’ L3 íŒíŠ¸ ë³´ê³  ë§í•˜ê¸° â†’ L4 ì‹¤ì „ í…ŒìŠ¤íŠ¸. ë“œë˜ê·¸ì•¤ë“œë¡­ ì œê±° | 2026-02-20 |
| ì„¸ì…˜ ë§Œë£Œ | 24ì‹œê°„ ë§Œë£Œ ì œê±°, ë§Œë£Œ ì—†ìŒ (ì–¸ì œë“  ì´ì–´í•˜ê¸°) | 2026-02-20 |
| ë°˜ë³µ í•™ìŠµ | Real Test í†µê³¼ í›„ 1ì¼â†’3ì¼â†’7ì¼â†’14ì¼ ë³µìŠµ ìŠ¤ì¼€ì¤„ ìë™ ìƒì„± | 2026-02-20 |
| ì„±ì¥ ì¶”ì  | tutoring_skill_historyë¡œ answer_typeë³„ pass_rate ì‹œê°„ ì¶”ì´ ê¸°ë¡ | 2026-02-20 |
| V2/V3 | ë¯¸ì´ê´€. V1 í•µì‹¬ë§Œ ë‹¨ì¼ ë²„ì „ìœ¼ë¡œ | 2026-02-20 |
| Edge Function | 10ê°œ+ìœ í‹¸20ê°œ â†’ 1ê°œ tutoring/ (C-1) | 2026-02-20 |

### ì‰ë„ì‰
| í•­ëª© | ê²°ì • | ë‚ ì§œ |
|------|------|------|
| í…Œì´ë¸” êµ¬ì¡° | shadowing_sessions + shadowing_evaluations (2ê°œ). íŒ¨í‚¤ì§€ëŠ” script_packages ê³µìœ  (4ë‹¨ê³„) | 2026-02-20 |
| 4ê°€ì§€ ëª¨ë“œ | Listen(í´ë¼ì´ì–¸íŠ¸) / Training(í´ë¼ì´ì–¸íŠ¸) / Assessment(API) / Real Test(API). Listen+Trainingì€ DB ë¶ˆí•„ìš” | 2026-02-20 |
| í‰ê°€ êµ¬ì¡° | 5ì˜ì—­(pronunciation/fluency/grammar/vocabulary/content) + OPIc ë“±ê¸‰ ì¶”ì • + ìŠ¤í¬ë¦½íŠ¸ í™œìš©ë„. ì†Œë¦¬ë‹´ê³¼ ë™ì¼ | 2026-02-20 |
| ì„¸ì…˜ ë§Œë£Œ | ì œê±° (expires_at ì—†ìŒ) | 2026-02-20 |
| í”„ë¡¬í”„íŠ¸ | ai_prompt_templatesì— 'evaluate_shadowing' í¬í•¨ (ì „ì²´ 4í–‰ ì¤‘ 1ê°œ) | 2026-02-20 |
| Edge Function | scripts/ í•˜ìœ„ í•¸ë“¤ëŸ¬ 3ê°œ ì¶”ê°€ (ë³„ë„ í•¨ìˆ˜ ìƒì„± ì•ˆ í•¨) | 2026-02-20 |
| íƒ€ì„ìŠ¤íƒ¬í”„ ë§¤ì¹­ | ì†Œë¦¬ë‹´ Levenshtein + ê°­ ë³´ì • ì•Œê³ ë¦¬ì¦˜ ê·¸ëŒ€ë¡œ ì´ê´€ | 2026-02-20 |
| íŠœí„°ë§ L2ì™€ ì°¨ì´ | ë…ë¦½ ëª¨ë“ˆ (ì‚¬ìš©ì ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜, 4ëª¨ë“œ, ìƒì„¸ í‰ê°€) vs íŠœí„°ë§ íë¦„ ì¼ë¶€ (êµì • ë‹µë³€ ê¸°ë°˜, ìœ ì‚¬ë„ë§Œ) | 2026-02-20 |

---

## ë¶„ì„ ê³¼ì • ê¸°ë¡ (ì¬í˜„ ê°€ì´ë“œ)

> ì´ ë¬¸ì„œì˜ ì„¤ê³„ ê²°ì •ì€ ì†Œë¦¬ë‹´(soridam) ì½”ë“œë² ì´ìŠ¤ì˜ ì‹¤ì œ ë¶„ì„ì— ê¸°ë°˜í•œë‹¤.
> ì•„ë˜ ê¸°ë¡ì„ ë”°ë¥´ë©´ ë™ì¼í•œ ë¶„ì„ì„ ì¬í˜„í•  ìˆ˜ ìˆë‹¤.

### ì†Œë¦¬ë‹´ í”„ë¡œì íŠ¸ ìœ„ì¹˜

```
C:\Users\js777\Desktop\soridam
```

### ì˜¤í”½í†¡ë‹¥ DB ì ‘ì† ì •ë³´

```bash
export PGPASSWORD=$(printf '%s' 'opictalkdoc2026!!')
PGCLIENTENCODING='UTF8' "/c/Program Files/PostgreSQL/16/bin/psql" \
  -h aws-1-ap-northeast-2.pooler.supabase.com \
  -p 6543 \
  -U postgres.rwdsyqnrrpwkureqfxwb \
  -d postgres \
  --set=sslmode=require \
  -c "SQLë¬¸"
```

### ë‹¨ê³„ë³„ ë¶„ì„ ë°©ë²•

#### 1ë‹¨ê³„: ê³µí†µ ê¸°ë°˜ (15ê°œ ë¬¸ì œì  ë„ì¶œ)

**ë¶„ì„ ëŒ€ìƒ**: ì†Œë¦¬ë‹´ ì „ì²´ í”„ë¡œì íŠ¸
```
ê²€ìƒ‰ ëŒ€ìƒ:
- supabase/migrations/*.sql          â†’ í…Œì´ë¸” êµ¬ì¡°, FK, íŠ¸ë¦¬ê±°, RLS
- supabase/functions/*/index.ts      â†’ Edge Function ëª©ë¡ (44ê°œ í™•ì¸)
- src/types/*.ts                     â†’ TypeScript íƒ€ì… ì •ì˜
- src/stores/*.ts                    â†’ Zustand ìƒíƒœ ê´€ë¦¬ êµ¬ì¡°
```

**í•µì‹¬ ë°œê²¬**:
- `supabase/migrations/` í´ë”ì—ì„œ í…Œì´ë¸” 23ê°œ+ í™•ì¸
- `supabase/functions/` í´ë”ì—ì„œ Edge Function 44ê°œ í™•ì¸
- FK ì—†ì´ ì½”ë“œ ë ˆë²¨ ì°¸ì¡°ë§Œ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ ë‹¤ìˆ˜ ë°œê²¬
- VARCHAR íƒ€ì…ì— CHECK/ENUM ì—†ëŠ” ìƒíƒœ ì»¬ëŸ¼ë“¤ ë°œê²¬
- `process_custom_mode_questions()` DB íŠ¸ë¦¬ê±°ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³¼ë‹¤ ì§‘ì¤‘

#### 2ë‹¨ê³„: ì‹œí—˜í›„ê¸° (Submissions) ë¶„ì„

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
```
ì†Œë¦¬ë‹´ DB:
- supabase/migrations/ â†’ submissions, submission_questions, submission_combos, custom_mode_questions í…Œì´ë¸”
- supabase/functions/submission-*/ â†’ ê´€ë ¨ Edge Function 6ê°œ+

ì†Œë¦¬ë‹´ í”„ë¡ íŠ¸ì—”ë“œ:
- src/components/datalab/ â†’ DataLab ì»´í¬ë„ŒíŠ¸ (ë¹ˆë„ ë¶„ì„, í›„ê¸° ì œì¶œ)
- src/stores/submissionStore.ts â†’ ìƒíƒœ ê´€ë¦¬

ì†Œë¦¬ë‹´ ë¬¸ì„œ:
- docs/archive/22_ëª¨ì˜ê³ ì‚¬_ì‹œìŠ¤í…œ_ì™„ì „_ê°€ì´ë“œ_v2.md â†’ submission_combos ìŠ¤í‚¤ë§ˆ ì°¸ì¡°
```

**í•µì‹¬ ë°œê²¬**:
- `custom_mode_questions`(DB íŠ¸ë¦¬ê±° ìë™ ìƒì„±)ê³¼ `submission_combos`(Edge Function ìƒì„±) ì´ì¤‘í™” ì¡´ì¬
- ì½¤ë³´ ìƒì„± íŠ¸ë¦¬ê±° `process_custom_mode_questions()`ì— ì¹´í˜/í•˜ì´í‚¹/ê³µì› í•˜ë“œì½”ë”© ì œì™¸ ê·œì¹™
- `frequency` ì»¬ëŸ¼ì€ ê°™ì€ ì½¤ë³´ ë°˜ë³µ ì‹œ ì¦ê°€í•˜ëŠ” ì¹´ìš´í„° â†’ GROUP BY COUNT(*)ë¡œ ëŒ€ì²´ ê°€ëŠ¥
- ì„œë² ì´ í•„ë“œê°€ 8ê°œ ê°œë³„ ì»¬ëŸ¼ìœ¼ë¡œ ë˜ì–´ ìˆìŒ (JSONBê°€ ì•„ë‹Œ ê°œë³„ ì»¬ëŸ¼ ìœ ì§€ ê²°ì •)

#### 3ë‹¨ê³„: ëª¨ì˜ê³ ì‚¬ (Mock Test) ë¶„ì„

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
```
ì†Œë¦¬ë‹´ DB:
- supabase/migrations/ â†’ mock_test_sessions_v7, mock_test_answers_v7, mock_test_evaluations_v7,
                          holistic_evaluations_v7, mock_test_evaluation_queue, mock_test_eval_settings

ì†Œë¦¬ë‹´ Edge Functions:
- supabase/functions/mock-test-*/ â†’ 18ê°œ í•¨ìˆ˜
  ì£¼ìš”: mock-test-create-session, mock-test-submit-answer, mock-test-evaluate-answer,
        mock-test-generate-report, mock-test-get-results

ì†Œë¦¬ë‹´ í”„ë¡ íŠ¸ì—”ë“œ:
- src/components/mock-test/ â†’ ëª¨ì˜ê³ ì‚¬ UI ì»´í¬ë„ŒíŠ¸
- src/stores/mockTestStore.ts â†’ 15ë¬¸ì œ ì„¸ì…˜ ê´€ë¦¬
- src/services/ruleEngine/ â†’ V7 ê·œì¹™ ì—”ì§„ (Floor/Ceiling/AL 7ë‹¨ê³„ íŒì •)

ì†Œë¦¬ë‹´ ë¬¸ì„œ:
- docs/archive/22_ëª¨ì˜ê³ ì‚¬_ì‹œìŠ¤í…œ_ì™„ì „_ê°€ì´ë“œ_v2.md (Â§7) â†’ í‰ê°€ ì²´í¬ë°•ìŠ¤ êµ¬ì¡°
```

**í•µì‹¬ ë°œê²¬**:
- V7 ì ‘ë¯¸ì‚¬ê°€ ëª¨ë“  í…Œì´ë¸”ì— ë¶™ì–´ ìˆìŒ (v1~v6 í…Œì´ë¸”ë„ ë‚¨ì•„ ìˆìŒ)
- `mock_test_evaluation_queue`ê°€ ë³„ë„ í…Œì´ë¸”ë¡œ ì¡´ì¬ â†’ answersì— eval_status í†µí•©ìœ¼ë¡œ ì œê±° ê°€ëŠ¥
- `holistic_evaluations_v7`ì´ ë¦¬í¬íŠ¸ ì—­í•  â†’ `mock_test_reports`ë¡œ ëª…ì¹­ ë³€ê²½
- ê·œì¹™ ì—”ì§„ì´ TypeScriptë¡œ í”„ë¡ íŠ¸ì—”ë“œì— ìˆì—ˆìœ¼ë‚˜ ì‹¤ì œë¡œëŠ” Edge Functionì—ì„œ ì‹¤í–‰ (B-1 ì´ë¯¸ í•´ê²°)
- í‰ê°€ 2ë‹¨ê³„: Stage A(STT+Azure ë°œìŒ) â†’ Stage B(GPT-4.1 ì²´í¬ë°•ìŠ¤) â†’ fire-and-forget íŒ¨í„´
- ìƒíƒœ í´ë§ ë°©ì‹ ì‚¬ìš© ì¤‘ â†’ í‰ê°€ 2~3ë¶„ ì†Œìš” í™•ì¸ â†’ Supabase Realtimeìœ¼ë¡œ ë³€ê²½ ê²°ì •

#### 4ë‹¨ê³„: ìŠ¤í¬ë¦½íŠ¸ (Scripts) ë¶„ì„

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
```
ì†Œë¦¬ë‹´ DB:
- supabase/migrations/ â†’ ai_training_scripts, ai_training_packages, ai_training_cache
- template_prompts í…Œì´ë¸” (V6 ìŠ¤í¬ë¦½íŠ¸ ìƒì„± í”„ë¡¬í”„íŠ¸)
- script_prompt_templates í…Œì´ë¸” (ìµœì‹  RCTF í”„ë¡¬í”„íŠ¸)
- script_specs í…Œì´ë¸” (60í–‰ ê·œê²©ì„œ)

ì†Œë¦¬ë‹´ Edge Functions:
- supabase/functions/ai-training-generate-script-v6/ â†’ V6 ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (í•µì‹¬)
- supabase/functions/ai-training-generate-package/ â†’ íŒ¨í‚¤ì§€ ìƒì„± (TTS)
- supabase/functions/ai-training-generate-shadowing/ â†’ ì‰ë„ì‰ JSON ìƒì„±
- supabase/functions/ai-training-*/ â†’ ì´ 13ê°œ í•¨ìˆ˜

ì†Œë¦¬ë‹´ í”„ë¡ íŠ¸ì—”ë“œ:
- src/services/AIPermissionService.ts â†’ í¬ì¸íŠ¸/êµ¬ë… ê¶Œí•œ ì²´í¬
- src/stores/scriptStore.ts â†’ ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœ ê´€ë¦¬
```

**í•µì‹¬ ë°œê²¬ (í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ)**:
- **3ê°€ì§€ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë°©ì‹ í˜¼ì¬**:
  1. `template_prompts` í…Œì´ë¸”: V6 template ëª¨ë“œ (prompt_id='description_il-im2' ë“±), `target_levels[]` ë°°ì—´ë¡œ ë“±ê¸‰ ê·¸ë£¹ ë§¤ì¹­
  2. `template_prompts` í…Œì´ë¸”: AI generator ëª¨ë“œ (prompt_id='description_ai_generator')
  3. `script_prompt_templates` í…Œì´ë¸”: RCTF í˜•ì‹ (template_id='generate'/'correct')
- **`script_prompt_templates`ì´ ê°€ì¥ ìµœì‹ ** (ì‚¬ìš©ì í™•ì¸: "íŠœí„°ë§ êµì •ì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡¬í”„íŠ¸ê°€ ê°€ì¥ ìµœê·¼ì— ë§Œë“ ê±°ì•¼")
- `script_specs` 60í–‰ (10 answer_type Ã— 6 level): Markdown ê·œê²©ì„œ, `total_slots` í¬í•¨
- RCTF í˜•ì‹: `â•â•â•` êµ¬ë¶„ìë¡œ [R]Role â†’ [C]Context â†’ [T]Task â†’ [F]Format 4ì„¹ì…˜
- content ì•ˆì— `${script_spec}` í”Œë ˆì´ìŠ¤í™€ë” â†’ script_specs.content ì‚½ì…
- **ì‚¬ìš©ì ê²°ì •**: ì˜¤í”½í†¡ë‹¥ì€ 1ê°€ì§€ ë°©ì‹(RCTF)ìœ¼ë¡œ í†µì¼, generate/correct ë™ì¼ í”„ë¡¬í”„íŠ¸

**í”„ë¡¬í”„íŠ¸ ë¶„ì„ì— ì‚¬ìš©í•œ íŒŒì¼ ê²½ë¡œ**:
```
DB ë°ì´í„° í™•ì¸:
- docs/ë¶„ë¥˜ëŒ€ê¸°/ì†Œë¦¬ë‹´ ìŠ¤í¬ë¦½íŠ¸/db_content/create_tables.sql â†’ script_prompt_templates êµ¬ì¡°
- docs/ë¶„ë¥˜ëŒ€ê¸°/ì†Œë¦¬ë‹´ ìŠ¤í¬ë¦½íŠ¸/db_content/insert_script_specs.sql â†’ 60í–‰ ì‹œë“œ ë°ì´í„°

Edge Functionì—ì„œ ì‚¬ìš© í™•ì¸:
- supabase/functions/ai-training-generate-script-v6/index.ts â†’ template_prompts ì¡°íšŒ ë¡œì§
  - .from('template_prompts').select('*').eq('answer_type', answerType).contains('target_levels', [...])
  - script_method === 'ai' | 'template' | legacy ë¶„ê¸°
- supabase/functions/tutoring-generate-template-answer/index.ts â†’ script_prompt_templates ì¡°íšŒ ë¡œì§
  - .from('script_prompt_templates').select('content').eq('template_id', 'correct')
  - .from('script_specs').select('*').eq('guide_id', `${answerType}_${level}`)

íŠœí„°ë§ í”„ë¡¬í”„íŠ¸ í™•ì¸:
- supabase/migrations/20260115_create_tutoring_prompts.sql â†’ tutoring_prompts í…Œì´ë¸” (3í–‰)
  - prompt_key: 'generate_template', 'evaluate_level', 'evaluate_realtest'
```

#### 5ë‹¨ê³„: AI íŠœí„° (Tutoring) ë¶„ì„

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
```
ì†Œë¦¬ë‹´ DB:
- supabase/migrations/ â†’ ai_training_sessions (V1/V2/V3 ë³‘ì¡´),
                          ai_training_progress, ai_training_template_answers,
                          ai_training_attempts, tutoring_slot_templates
- tutoring_prompts í…Œì´ë¸” (3í–‰)

ì†Œë¦¬ë‹´ Edge Functions:
- supabase/functions/tutoring-*/ â†’ 10ê°œ í•¨ìˆ˜
  ì£¼ìš”: tutoring-start-session, tutoring-generate-template-answer,
        tutoring-evaluate-attempt, tutoring-next-question, tutoring-transcribe
- supabase/functions/_shared/ â†’ ê³µìœ  ìœ í‹¸ 20ê°œ+

ì†Œë¦¬ë‹´ í”„ë¡ íŠ¸ì—”ë“œ:
- src/components/tutoring/ â†’ V1/V2/V3 ì»´í¬ë„ŒíŠ¸ í˜¼ì¬
- src/stores/tutoringStore.ts â†’ ì„¸ì…˜ ê´€ë¦¬
- src/services/slotEvaluator.ts â†’ ìŠ¬ë¡¯ë³„ í‰ê°€ ë¡œì§
```

**í•µì‹¬ ë°œê²¬**:
- V1(4ë ˆë²¨)/V2(ë“œë˜ê·¸ ì•¤ ë“œë¡­)/V3(ì‹¤ì „ í…ŒìŠ¤íŠ¸) 3ë²„ì „ ë³‘ì¡´ â†’ V1 í•µì‹¬ë§Œ ë‹¨ì¼ ë²„ì „ìœ¼ë¡œ ê²°ì •
- Level 1ì´ ë“œë˜ê·¸ ì•¤ ë“œë¡­(ì½ê¸° ê²Œì„)ìœ¼ë¡œ í•™ìŠµ íš¨ê³¼ ë¶ˆëª…í™• â†’ ë“£ê³  ë”°ë¼ ì½ê¸°ë¡œ ë³€ê²½
- Level 2/3ì´ ìœ ì‚¬ (í‚¤ì›Œë“œ ë³´ê³  ë§í•˜ê¸° / ê¸°ëŠ¥ë§Œ ë³´ê³  ë§í•˜ê¸°) â†’ í†µí•©
- ì„¸ì…˜ 24ì‹œê°„ ë§Œë£Œ ì œí•œ â†’ ì‚¬ìš©ì ê²½í—˜ ì €í•´ â†’ ë§Œë£Œ ì œê±°
- ë°˜ë³µ í•™ìŠµ/ì„±ì¥ ì¶”ì  ê¸°ëŠ¥ ì—†ìŒ â†’ ì‹ ê·œ ì¶”ê°€ (review_schedule, skill_history)
- **ì‚¬ìš©ì ìš”ì²­**: "ì´ ê¸°ëŠ¥ì€ ì™„ì„±ì‘ì´ ì•„ë‹ˆë‹¤, ì¶”ì²œí•´ì¤˜" â†’ 4ë ˆë²¨ ì¬ì„¤ê³„ + ì‰ë„ì‰ ì¶”ê°€

**ì‚¬ìš©ì ê²°ì •ìœ¼ë¡œ ë³€ê²½ëœ í•µì‹¬ ì‚¬í•­**:
- tutoring_template_answers í…Œì´ë¸” ì œê±° â†’ scripts í…Œì´ë¸” ê³µìœ 
  - "ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìƒì„±í•˜ê±°ë‚˜, íŠœí„°ë§ì—ì„œ êµì •í•˜ëŠ”ê±´ ë‘˜ì´ ì„œë¡œ ê³µìœ í• êº¼ì•¼"
  - ê°™ì€ user_id + question_idë©´ ì¬í™œìš©, ì‚¬ìš©ì ëª…ì‹œ ìš”ì²­ ì‹œë§Œ ì¬ìƒì„±

#### 6ë‹¨ê³„: ì‰ë„ì‰ (Shadowing) ë¶„ì„

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
```
ì†Œë¦¬ë‹´ DB:
- supabase/migrations/ â†’ shadowing_test_sessions, shadowing_test_evaluations
- admin_prompts í…Œì´ë¸” (feature_type='shadowing_test')

ì†Œë¦¬ë‹´ Edge Functions:
- supabase/functions/ai-training-generate-shadowing/index.ts â†’ íƒ€ì„ìŠ¤íƒ¬í”„ JSON ìƒì„± (í•µì‹¬)
- supabase/functions/shadowing-test-create/index.ts â†’ í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ìƒì„±
- supabase/functions/shadowing-test-evaluate/index.ts â†’ STT + GPT í‰ê°€

í•µì‹¬ ìœ í‹¸:
- supabase/functions/ai-training-generate-shadowing/sentenceWordMatcher.ts
  â†’ Levenshtein Distance íƒ€ì„ìŠ¤íƒ¬í”„ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜
  â†’ matchSentencesToWords(): GPT ë¬¸ì¥ Ã— Whisper ë‹¨ì–´ ë§¤ì¹­
  â†’ fillTimestampGaps(): ë¬¸ì¥ ê°„ ê°­/ì˜¤ë²„ë© ë³´ì •

ì†Œë¦¬ë‹´ í”„ë¡ íŠ¸ì—”ë“œ:
- src/components/shadowing/ShadowingMain.tsx â†’ ë©”ì¸ ì»¨í…Œì´ë„ˆ
- src/components/shadowing/modes/ â†’ ListenMode, TrainingMode, AssessmentMode, RealTestMode
- src/services/shadowingService.ts â†’ SOLID íŒ¨í„´ (PackageRepository + Service)
- src/stores/useShadowingStore.ts â†’ Zustand (localStorage persist)
- src/api/shadowingTestApi.ts â†’ Edge Function í˜¸ì¶œ í´ë¼ì´ì–¸íŠ¸
```

**í•µì‹¬ ë°œê²¬**:
- 4ê°€ì§€ ëª¨ë“œ (Listen/Training/Assessment/Real Test) ì¤‘ Listen+Trainingì€ í´ë¼ì´ì–¸íŠ¸ ì™„ê²° (DB ë¶ˆí•„ìš”)
- Assessment/Real Testë§Œ ì„¸ì…˜+í‰ê°€ DB ì €ì¥
- 5ì˜ì—­ í‰ê°€: pronunciation, fluency, grammar, vocabulary, content (ê° 5ì  ë§Œì )
- ì‰ë„ì‰ JSON ìƒì„± = Whisper word-level STT + Levenshtein ë§¤ì¹­ + ê°­ ë³´ì •
- ì„¸ì…˜ 24ì‹œê°„ ë§Œë£Œ â†’ ì œê±° (5ë‹¨ê³„ì™€ ë™ì¼ ì›ì¹™)
- í¬ì¸íŠ¸ 10P/íšŒ + í™˜ë¶ˆ ë¡œì§ â†’ íšŸìˆ˜ì œë¡œ ì „í™˜ (B-4)
- admin_prompts í…Œì´ë¸” ì‚¬ìš© â†’ ai_prompt_templatesë¡œ í†µí•© (evaluate_shadowing)

### ì˜¤í”½í†¡ë‹¥ DBì—ì„œ ì‹¤í–‰í•œ ì‘ì—…

```sql
-- 1. master_questions ì‹œë“œ ë°ì´í„° ë¡œë“œ (510í–‰)
-- ì†Œë¦¬ë‹´ í”„ë¡œë•ì…˜ DBì—ì„œ CSV ì¶”ì¶œ í›„ \copyë¡œ ë¡œë“œ
-- íŒŒì¼: supabase/seed/master_questions.csv

-- 2. timezone ì„¤ì •
ALTER DATABASE postgres SET timezone TO 'Asia/Seoul';

-- 3. audio_url ë§ˆì´ê·¸ë ˆì´ì…˜ (ì†Œë¦¬ë‹´ â†’ ì˜¤í”½í†¡ë‹¥ Storage ë²„í‚·)
-- 510ê°œ ìŒì„± íŒŒì¼ URL ì—…ë°ì´íŠ¸
UPDATE master_questions SET audio_url = replace(audio_url, 'soridam-bucket', 'opictalkdoc-bucket');

-- 4. í™•ì¸ ì¿¼ë¦¬
SELECT COUNT(*) FROM master_questions;  -- 510
SELECT DISTINCT answer_type FROM master_questions;  -- 10ê°€ì§€ + NULL(ì‹œìŠ¤í…œ)
SELECT DISTINCT survey_type FROM master_questions;  -- ì„ íƒí˜•, ê³µí†µí˜•, ë¡¤í”Œë ˆì´, ì‹œìŠ¤í…œ
```

### ë¬¸ì„œ ì‘ì„± ìˆœì„œ

1. ì†Œë¦¬ë‹´ ì „ì²´ ìŠ¤ìº” â†’ 15ê°œ ë¬¸ì œì  ë„ì¶œ
2. ë¬¸ì œì ì„ 1ê°œì”© ë…¼ì˜ â†’ ì‚¬ìš©ìì™€ ê²°ì • â†’ ê²°ì • ê¸°ë¡ í…Œì´ë¸”ì— ê¸°ë¡
3. ëª¨ë“ˆë³„ ì†Œë¦¬ë‹´ ì½”ë“œ ë¶„ì„ â†’ ìƒì„¸ ì„¤ê³„ ì‘ì„± â†’ ì‚¬ìš©ì í™•ì¸ â†’ ìƒì„¸ ë‚´ìš© `<details>` ì ‘ê¸°ë¡œ ì¶”ê°€
4. ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜ ì‹œ ê´€ë ¨ ì„¹ì…˜ + ê²°ì • ê¸°ë¡ + ë³€ê²½ ìš”ì•½ í…Œì´ë¸” ë™ì‹œ ì—…ë°ì´íŠ¸
5. ì´ "ë¶„ì„ ê³¼ì • ê¸°ë¡" ì„¹ì…˜ì„ ë§ˆì§€ë§‰ì— ì¶”ê°€í•˜ì—¬ ì¬í˜„ ê°€ëŠ¥ì„± í™•ë³´

### ì‚¬ìš©ì ê²°ì •ì´ ì„¤ê³„ë¥¼ ë°”ê¾¼ ì£¼ìš” ìˆœê°„ë“¤

| ìˆœê°„ | ì‚¬ìš©ì ë°œì–¸ | ê¸°ì¡´ ì„¤ê³„ | ë³€ê²½ëœ ì„¤ê³„ |
|------|-----------|----------|------------|
| C-2 ìƒíƒœ ëª¨ë‹ˆí„°ë§ | "í‰ê°€ê°€ ë³´í†µ 2ë¶„~3ë¶„ì •ë„ ê±¸ë¦¬ëŠ”ë°?" | í´ë§ | Supabase Realtime |
| C-3 AI ë¹„ìš© ìµœì í™” | "ëª¨ë‘ ë‹¤ë¥¸ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—" + "ì´ë¯¸ V7ê¹Œì§€ ìµœì í™” ë¨" | ë°°ì¹˜/ìºì‹± ë„ì… | ê¸°ì¡´ V7 ë°©ì‹ ìœ ì§€ |
| í”„ë¡¬í”„íŠ¸ ë°©í–¥ | "ë°˜ëŒ€ë¡œ ì¼ê»„? íŠœí„°ë§ êµì • í”„ë¡¬í”„íŠ¸ê°€ ê°€ì¥ ìµœê·¼" | ìŠ¤í¬ë¦½íŠ¸ í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ | íŠœí„°ë§ RCTF í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ |
| í”„ë¡¬í”„íŠ¸ í†µì¼ | "ì˜¤í”½í†¡ë‹¥ì—ì„  1ê°€ì§€ ë°©ì‹ìœ¼ë¡œë§Œ. íŠœí„°ë§ì—ì„œ ì‚¬ìš©í•˜ëŠ”ê²ƒê³¼ ë™ì¼" | 3ê°€ì§€ ìƒì„± ë°©ì‹ | RCTF 1ê°œë¡œ í†µì¼ |
| AI íŠœí„° ì¶”ì²œ | "ì´ ê¸°ëŠ¥ì€ ì™„ì„±ì‘ì´ ì•„ë‹ˆê±°ë“ . ì¶”ì²œí•´ì¤„ë˜?" | ì†Œë¦¬ë‹´ V1 ê·¸ëŒ€ë¡œ ì´ê´€ | 4ë ˆë²¨ ì¬ì„¤ê³„ + ì‰ë„ì‰ ì¶”ê°€ + ë°˜ë³µí•™ìŠµ |
| ìŠ¤í¬ë¦½íŠ¸-íŠœí„°ë§ ê³µìœ  | "ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ê³¼ ë‹µë³€ êµì •ì€ í”„ë¡¬í”„íŠ¸ë¥¼ ê°™ì´ ì“°ê³ " | generate/correct ë³„ë„ í–‰ | ë™ì¼ í”„ë¡¬í”„íŠ¸ 1ê°œ (script_rctf) |
| scripts í†µí•© | "ì„œë¡œ ê³µìœ í• êº¼ì•¼. ìˆìœ¼ë©´ ì¬í™œìš©, ë§ˆìŒì— ì•ˆ ë“¤ë©´ ê·¸ë•Œ ì¬ìƒì„±" | tutoring_template_answers ë³„ë„ | scripts í…Œì´ë¸” í†µí•©, source ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ë¶„ |
| PDF ì œê±° | "pdf ìƒì„±ì€ ì—†ì• ì" | WAV + PDF + JSON (3íŒŒì¼) | WAV + JSON (2íŒŒì¼) |

---

*ìƒì„±ì¼: 2026-02-20*
*ìƒíƒœ: ì „ì²´ 6ë‹¨ê³„ ì„¤ê³„ ì™„ë£Œ â€” êµ¬í˜„ ëŒ€ê¸°*
