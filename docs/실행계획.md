# 오픽톡닥 (OPIcTalkDoc) 실행 계획서

> **이 문서 하나만 보면 오픽톡닥 개발 전체를 진행할 수 있다.**
> 각 단계에서 참조할 설계 문서를 명시해두었으니, 필요할 때 해당 문서를 펼쳐보면 된다.
> 의사결정 근거는 `의사결정.md` 참조.

---

## 관련 문서

| 문서 | 역할 | 언제 보는가 |
|------|------|------------|
| **이 문서 (실행계획.md)** | 마스터 실행 가이드 | 항상 — 다음에 뭘 할지 여기서 확인 |
| `의사결정.md` | 제품/기술 의사결정 기록 | 결정 근거 확인, 미결 사항 추적 |
| `설계/공통기반.md` | DB 원칙, 백엔드 아키텍처 | 모듈 구현 전 공통 원칙 확인 |
| `설계/시험후기.md` ~ `설계/쉐도잉.md` | 모듈별 상세 설계 | 해당 모듈 구현 시 |
| `참조/소리담_기능분석.md` | 이관 요약 + 분석결과 인덱스 | 소리담 원본 구조 확인 시 |
| `참조/소리담_분석결과.md` | 상세 레퍼런스 (60KB) | 소리담 스키마, API, 타입 상세 |
| `사업운영.md` | 사업/행정/결제 | 결제 연동, PG사 계약 확인 시 |
| `디자인시스템.md` | 아토믹 디자인 시스템 | UI 컴포넌트 구현 시 |

---

## 개발 원칙

- **소리담 최종 버전만 이관**: 모든 레거시(v4/v6) 무시, 최종 버전(v7 등)만 가져옴
- **오픽톡닥에서 모두 v1**: 소리담 버전 접미사 제거 (예: `evaluations_v7` → `evaluations`)
- **인증/결제는 새로 구축**: 소리담 코드 복사 X → 업계 표준 방식
- **DB는 새로 설계**: 소리담 스키마를 참고하되 정리해서 새로 만듦
- **하이브리드 백엔드** (T-9): CRUD = Server Actions, AI API 호출 = Edge Functions, 웹훅 = API Routes
- **Server Actions**: 데이터 조회(Server Component), 데이터 변경(Server Action) — 시험후기 전체, 나머지 모듈의 CRUD
- **Edge Functions**: GPT/Whisper/Gemini TTS/Azure Speech 등 장시간 AI 처리 — 스크립트/모의고사/튜터링의 AI 호출
- **UI는 오픽톡닥 브랜드**: Tailwind 4.x + 테라코타 웜톤 디자인 시스템
- **모듈별 풀스택 이관**: DB → RLS → Server Actions → TypeScript 타입 → UI → 테스트

---

## 개발 순서 총괄

```
Phase 1 (인증) ✅ 완료
    ↓
Phase 2 (랜딩/필수 페이지) ✅ 완료
    ↓
Phase 3 (핵심 모듈 이관) ← 현재 단계 (Step 1 완료, Step 2 대기)
    ↓
Phase 4 (결제 연동) ✅ 기본 완료 (PG사 본계약 진행 중)
    ↓
Phase 5 (관리자)
```

---

## Phase 1. 인증 시스템 ✅ 완료

> Supabase Auth 기반, 업계 표준 방식으로 새로 구축.

| 항목 | 상태 |
|------|------|
| Supabase Auth 설정 (이메일 + Google OAuth) | ✅ |
| 로그인/회원가입 페이지 | ✅ |
| 비밀번호 찾기/재설정 | ✅ |
| 프로필 설정/수정 (마이페이지) | ✅ |
| 미들웨어 세션 관리 | ✅ |
| Server Actions (auth.ts) | ✅ |

---

## Phase 2. 랜딩 페이지 & 필수 페이지 ✅ 완료

> 카드사 심사 요건 충족 + 서비스 소개.

| 항목 | 상태 |
|------|------|
| 랜딩 페이지 ("나는 내 삶의 주인공이다" 무대 메타포) | ✅ |
| 요금제 페이지 (무료/베이직 ₩19,900/프리미엄 ₩49,900 + 횟수권) | ✅ |
| 이용약관/개인정보처리방침/환불규정 | ✅ |
| Navbar + Footer 공통 레이아웃 | ✅ |
| 사업자정보 푸터 (카드사 심사 요건) | ✅ |
| 전략 가이드 페이지 (/strategy, 10섹션) | ✅ |
| 넛지 배너 + 등급 설정 모달 (P-1) | ✅ |
| 대시보드 실데이터 연동 (P-3, 1단계) | ✅ |
| 로고 이미지 시스템 (Canvas API + Jua 폰트, 8종) | ✅ |

---

## Phase 3. 핵심 모듈 이관 ← 현재 단계

> 소리담에서 선별한 기능을 오픽톡닥에 이관.
> **이 Phase가 개발의 핵심이며, 모듈별로 순서대로 진행한다.**
> 백엔드 아키텍처: 하이브리드 — CRUD=Server Actions, AI=Edge Functions (T-9)

### 레이아웃 구조 (확정)

| 레이아웃 | 용도 | 포함 |
|----------|------|------|
| **(dashboard)** | 탐색/허브 페이지 | Navbar + Footer |
| **(immersive)** | 활동/몰입 페이지 | ImmersiveHeader만 |

### 네비게이션 + 모듈별 탭 구조 (확정)

```
대시보드 | 시험후기 | 스크립트 | 모의고사 | 튜터링
```

| 모듈 | 경로 | 탭 | UI 셸 |
|------|------|-----|--------|
| **시험후기** | `/reviews` | 빈도 분석 \| 후기 제출 \| 시험 후기 | ✅ 완료 |
| **스크립트** | `/scripts` | 스크립트 생성 \| 내 스크립트 \| 쉐도잉 훈련 | ✅ 완료 |
| **모의고사** | `/mock-exam` | 응시 \| 결과 \| 나의 이력 | ✅ 완료 |
| **튜터링** | `/tutoring` | 진단 \| 처방 \| 훈련 | ✅ 완료 |

> 쉐도잉은 스크립트와 동일 연장선(패키지 생성 → 쉐도잉 훈련)이므로 스크립트 모듈에 통합

### 몰입형 페이지 (확정)

| 페이지 | 경로 | 설명 |
|--------|------|------|
| 모의고사 세션 | `/mock-exam/session` | 15문제 순차 진행 |
| 스크립트 생성 | `/scripts/create` | AI 스크립트 생성 |
| 쉐도잉 훈련 | `/scripts/shadowing` | 4모드 쉐도잉 |
| 튜터링 훈련 | `/tutoring/training` | 4레벨 훈련 |

### 이관 순서 (확정)

```
Step 0: 핵심 코어 (master_questions) ✅ 완료
    ↓
Step 1: 시험후기 ✅ 완료 (Server Actions only)
    ↓
Step 2: 스크립트 ← 다음 작업 (Server Actions + Edge Functions)
    ↓
Step 3: 모의고사 (Server Actions + Edge Functions)
    ↓
Step 4: 튜터링 (Server Actions + Edge Functions)
```

### 각 모듈 이관 절차 (공통)

```
1. DB 설계         → Supabase 마이그레이션 SQL 작성
2. RLS 정책        → Row Level Security 설정
3. Server Actions  → 'use server' CRUD 함수 작성
4. Edge Functions  → AI API 호출 함수 작성 (T-9, 해당 모듈만)
5. TypeScript 타입 → 프론트에서 쓸 타입 정의
6. 상태관리        → Zustand 스토어 (필요 시)
7. UI 컴포넌트     → 페이지 + 컴포넌트 구현
8. 테스트          → 동작 확인
```

---

### Step 0: 핵심 코어 — master_questions ✅ 완료

> **모든 모듈의 기반. 이것 없이는 아무것도 동작하지 않는다.**
> 📖 상세: `참조/소리담_분석결과.md` §2, §3

#### 완료 내역

| 항목 | 상태 |
|------|------|
| `master_questions` 테이블 생성 (ENUM, RLS, 인덱스) | ✅ |
| 510개 시드 데이터 INSERT (소리담 프로덕션 추출) | ✅ |
| RPC `find_similar_questions_by_frequency()` | ✅ |
| Storage 버킷 `audio-recordings` 생성 | ✅ |

#### M-1 결정 사항

`custom_mode_questions` 테이블은 **삭제** (의사결정 M-1).
→ `submission_combos` 테이블로 대체. Step 1 시험후기에서 함께 설계.

#### answer_type 10가지 (반드시 기억)

| answer_type | 한국어 | OPIc 문항 |
|-------------|--------|-----------|
| description | 묘사하기 | 2~10번 |
| routine | 루틴 설명 | 2~10번 |
| comparison | 비교하기 | 2~10번 |
| past_experience_memorable | 과거경험(기억에 남는) | 2~10번 |
| past_experience_recent | 과거경험(최근) | 2~10번 |
| past_experience_childhood | 과거경험(어린시절) | 2~10번 |
| roleplay_11 | 롤플레이 11번 | 11번 |
| roleplay_12 | 롤플레이 12번 | 12번 |
| roleplay_13 | 롤플레이 13번 | 13번 |
| advanced_14 / advanced_15 | 어드밴스 | 14~15번 |

---

### Step 1: 시험후기 ✅ 완료

> 시험 후기 제출 (3단계 위저드) + 출제 빈도 분석 + 공개 후기 열람 + 콤보 데이터 생성.
> 📖 상세 설계: `설계/시험후기.md`
> 📖 소리담 원본: `참조/소리담_분석결과.md` §6

#### 완료 내역 (2026-02-23)

| 항목 | 상태 |
|------|------|
| DB 3테이블 (submissions, submission_questions, submission_combos) | ✅ |
| RLS 정책 (본인 CRUD + complete 전체 읽기) | ✅ |
| 인덱스 6개 + updated_at 트리거 | ✅ |
| increment_script_credits RPC 함수 | ✅ |
| TypeScript 타입 + Zod 스키마 (types/reviews.ts, validations/reviews.ts) | ✅ |
| 콤보 추출기 (utils/combo-extractor.ts) | ✅ |
| Server Actions 12개 (actions/reviews.ts) | ✅ |
| master_questions 쿼리 (queries/master-questions.ts) | ✅ |
| 위저드 3단계 UI (wizard-step1/2/3.tsx) | ✅ |
| 주제 선택 + 질문 선택 컴포넌트 (topic-pagination, question-selector) | ✅ |
| 빈도 분석 탭 (frequency-tab.tsx) | ✅ |
| 후기 제출 탭 (submit-tab.tsx) | ✅ |
| 공개 후기 탭 (list-tab.tsx) | ✅ |
| 크레딧 보상 P-2 (월 2건 제한, script_credits +2) | ✅ |

#### 파일 목록 (15개 생성 + 2개 수정)

```
frontend/
├── lib/
│   ├── types/reviews.ts          (생성)
│   ├── validations/reviews.ts    (생성)
│   ├── utils/combo-extractor.ts  (생성)
│   ├── actions/reviews.ts        (생성)
│   └── queries/master-questions.ts (생성)
├── components/reviews/
│   ├── reviews-content.tsx       (수정)
│   ├── frequency/frequency-tab.tsx (생성)
│   ├── submit/
│   │   ├── submit-tab.tsx        (생성)
│   │   ├── wizard-step1.tsx      (생성)
│   │   ├── wizard-step2.tsx      (생성)
│   │   ├── wizard-step3.tsx      (생성)
│   │   ├── topic-pagination.tsx  (생성)
│   │   └── question-selector.tsx (생성)
│   └── list/list-tab.tsx         (생성)
└── app/(dashboard)/reviews/page.tsx (수정)
supabase/migrations/003_submissions.sql (생성)
```

#### 미결 사항
- **M-3**: 소리담 기존 후기 데이터 이관 여부 ⏳

---

### Step 2: 스크립트

> AI 스크립트 생성 + 패키지(WAV+JSON) + 내 스크립트 관리 + 쉐도잉 훈련.
> 📖 상세 설계: `설계/스크립트.md`, `설계/쉐도잉.md`
> 📖 소리담 원본: `참조/소리담_분석결과.md` §9, §10, §11

#### DB 테이블 (6개)

| 테이블 | 용도 | 소리담 대비 변경 |
|--------|------|------------------|
| `scripts` | 스크립트 마스터 (생성+교정 공유, source 구분) | ai_training_scripts → scripts 통합 |
| `script_packages` | TTS 음성 + 타임스탬프 (WAV+JSON) | PDF 제거 |
| `ai_prompt_templates` | RCTF 프롬프트 (스크립트+튜터링 공유) | 3가지 → 1가지 통일 |
| `script_specs` | 등급별 규격서 (60행) | 신규 |
| `shadowing_sessions` | 쉐도잉 세션 (Assessment/Real Test만) | 만료 없음 |
| `shadowing_evaluations` | AI 평가 (5영역 + OPIc 등급) | shadowing_attempts → evaluations |

#### Server Actions (스크립트)

| Action | 용도 |
|--------|------|
| `generateScript` | AI 스크립트 생성 (RCTF 프롬프트) |
| `refineScript` | 스크립트 수정/정제 |
| `listScripts` / `getScript` / `deleteScript` | CRUD |
| `generatePackage` | Step 1 TTS (Gemini) |
| `generateShadowing` | Step 2 타임스탬프 (Whisper) |
| `getPackageStatus` | 패키지 진행 조회 |

#### Server Actions (쉐도잉)

| Action | 용도 |
|--------|------|
| `createShadowingSession` | 세션 생성 (Assessment/Real Test) |
| `evaluateShadowing` | Whisper STT + GPT 평가 |
| `getShadowingHistory` | 평가 히스토리 |

> Listen/Training 모드는 **클라이언트 완결** (DB 불필요)

#### 핵심 변경

- scripts 테이블 `UNIQUE(user_id, question_id)` → 스크립트+튜터링이 동일 테이블 공유
- `source='generate'` (스크립트 모듈), `source='correct'` (튜터링 교정)
- 쉐도잉 4모드: Listen/Training(클라이언트) + Assessment/Real Test(API)

---

### Step 3: 모의고사

> 15문제 세션 + V7 평가 (체크박스 + 규칙엔진) + FACT 점수 리포트.
> 📖 상세 설계: `설계/모의고사.md`
> 📖 소리담 원본: `참조/소리담_분석결과.md` §7

#### DB 테이블 (5개)

| 테이블 | 용도 | 소리담 대비 변경 |
|--------|------|------------------|
| `mock_test_sessions` | 세션 (question_ids TEXT[]) | JSONB → TEXT[] |
| `mock_test_answers` | 답변 + 평가 큐 통합 (eval_status) | queue 테이블 통합 |
| `mock_test_evaluations` | 개별 문항 평가 (체크박스) | v7 접미사 제거 |
| `mock_test_reports` | 종합 평가 + FACT + 등급 | holistic_evaluations → reports |
| `mock_test_eval_settings` | 관리자 설정 (단일 행) | 신규 |

#### Server Actions

| Action | 용도 |
|--------|------|
| `createSession` | 15문제 출제 (submission_combos 기반) |
| `submitAnswer` | 답변 제출 + Storage 업로드 |
| `processAnswer` | Stage A: Whisper STT + Azure 발음 |
| `evaluateAnswer` | Stage B: GPT-4.1 체크박스 |
| `generateReport` | 규칙엔진 + FACT 점수 + 리포트 |
| `getStatus` | 진행 상태 (Supabase Realtime + 폴링 폴백) |
| `getSession` / `getHistory` | 세션/이력 조회 |

#### 핵심 변경

- **출제**: submission_combos 기반 (custom_mode_questions 대체)
- **2단계 평가**: Stage A (STT+발음) → Stage B (GPT-4.1 체크박스)
- **상태 모니터링**: 2초 폴링 → **Supabase Realtime** + 폴링 폴백
- **규칙엔진**: TypeScript (LLM 아님), Floor/Ceiling/AL/Gate-Keeper 판정

---

### Step 4: 튜터링 (구 AI 튜터)

> 모의고사 결과 기반 진단 → 처방 → 4레벨 훈련.
> 📖 상세 설계: `설계/튜터링.md`
> 📖 소리담 원본: `참조/소리담_분석결과.md` §8

#### DB 테이블 (6개 + scripts 공유)

| 테이블 | 용도 | 소리담 대비 변경 |
|--------|------|------------------|
| `tutoring_sessions` | 세션 (만료 없음) | expires_at 제거 |
| `tutoring_progress` | 유형별 진행 (level1~4 상태) | current_level → 각 레벨별 상태 |
| `tutoring_attempts` | 훈련 시도 (score, slot_evaluations) | 이름 변경 |
| `tutoring_slot_templates` | 슬롯 뼈대 (시드 데이터) | 유지 |
| `tutoring_review_schedule` | 복습 스케줄 (1→3→7일) | **신규** |
| `tutoring_skill_history` | 성장 추적 (pass_rate 추이) | **신규** |

> 교정 스크립트는 `scripts` 테이블 공유 (`source='correct'`)

#### Server Actions

| Action | 용도 |
|--------|------|
| `startSession` | 세션 시작 + 약점 분석 |
| `getDiagnosis` / `getProgress` | 진단/진행 조회 |
| `generateCorrectedScript` | AI 교정 (scripts에 UPSERT) |
| `evaluateAttempt` | Level 1~4 훈련 평가 |
| `nextQuestion` | 다음 유형 활성화 |
| `getReviewSchedule` / `getSkillHistory` | 복습/성장 조회 |

#### 4레벨 재설계 (소리담 대비 변경)

| 레벨 | 소리담 | 오픽톡닥 |
|------|--------|----------|
| Level 1 | 드래그 앤 드롭 | **듣고 따라 읽기** (Read Aloud) |
| Level 2 | 키워드 보고 말하기 | **쉐도잉** (텍스트 없이 따라 말하기) |
| Level 3 | 기능만 보기 | **힌트 보고 말하기** (Guided Speaking) |
| Level 4 | 실전 | **Real Test** (동일) |

---

### 공통 인프라 (모든 모듈에서 사용)

> 📖 소리담 원본: `참조/소리담_분석결과.md` §12

#### 권한 체크 (소리담 대비 변경)

| 소리담 | 오픽톡닥 |
|--------|----------|
| AIPermissionService (포인트 시스템) | **구독 횟수 체크** (user_credits) |
| 포인트 50P/100P 차감 | 크레딧 1회 차감 (플랜 → 횟수권 순서) |

#### 외부 서비스 API 키 필요

| 서비스 | 용도 | 준비 상태 |
|--------|------|----------|
| OpenAI | GPT-4.1 (평가/생성), Whisper (STT) | 미준비 |
| Azure | Speech Service (발음 평가) | 미준비 |
| Google Gemini | TTS (음성 합성) | 미준비 |

---

## Phase 4. 결제 연동 ✅ 기본 완료

> 포트원 V2 기반 결제 시스템. 기본 구현 완료, PG사 본계약 진행 중.
> 📖 상세: `사업운영.md` §4

#### 완료 내역

| 항목 | 상태 |
|------|------|
| `@portone/browser-sdk` 설치 (포트원 V2) | ✅ |
| `orders` + `user_credits` DB 테이블 | ✅ |
| `/api/payment/verify` 결제 검증 API | ✅ |
| `/api/payment/webhook` 결제 취소 웹훅 | ✅ |
| 스토어 페이지 (4개 상품) | ✅ |
| KG이니시스 결제창 동작 확인 (프로덕션) | ✅ |

#### 상품 구성

| 상품 | 가격 | 내용 |
|------|------|------|
| 베이직 플랜 | ₩19,900 | 모의고사 3회 + 스크립트 10회 |
| 프리미엄 플랜 | ₩49,900 | 모의고사 10회 + 스크립트 30회 |
| 모의고사 횟수권 | ₩7,900 | 모의고사 3회 (영구) |
| 스크립트 횟수권 | ₩3,900 | 스크립트 5회 (영구) |

#### 남은 작업

| 항목 | 상태 | 비고 |
|------|------|------|
| KG이니시스 본계약 + 전자서명 | ⏳ | 가계약 기간 내 (~ 2026-03-19) |
| KG이니시스 정기결제 MID | ⏳ | 발급 대기 |
| 카카오페이 심사 완료 | ⏳ | 보완 회신 완료, 결과 대기 |
| 네이버페이 심사 완료 | ⏳ | 재심사 요청 완료, 결과 대기 |
| 토스페이 MID 발급 | ⏳ | 입점 정보 회신 완료, 대기 |
| 통신판매업 신고 | ⏳ | 에스크로 확인증 필요 (본계약 후) |

---

## Phase 5. 관리자 페이지

> Phase 3 완성 후 필요한 관리 기능을 결정.

| 후보 기능 | 우선순위 |
|----------|---------|
| master_questions 관리 (CRUD) | 높음 |
| 사용자 관리 | 높음 |
| 구독/결제 관리 | 높음 |
| 시드 데이터 관리 (스킬, 프롬프트, 규격서) | 중간 |
| 통계 대시보드 | 낮음 |

---

## 현재 진행 상태

| Phase | 상태 | 비고 |
|-------|------|------|
| Phase 1 (인증) | ✅ 완료 | Supabase Auth + 프로필 |
| Phase 2 (랜딩/필수) | ✅ 완료 | 브랜딩 리뉴얼 + 넛지 배너 + 대시보드 실데이터 |
| **Phase 3 (핵심 모듈)** | **🔄 진행 중** | **Step 1 완료, Step 2 스크립트 대기** |
| Phase 4 (결제) | ✅ 기본 완료 | 포트원 V2 + KG이니시스, PG사 본계약 진행 중 |
| Phase 5 (관리자) | ⏳ 대기 | Phase 3 완료 후 |

### Phase 3 세부 진행

| Step | 모듈 | 상태 | 백엔드 | 비고 |
|------|------|------|--------|------|
| Step 0 | 핵심 코어 | ✅ 완료 | - | master_questions 510행, custom_mode_questions 삭제(M-1) |
| Step 1 | 시험후기 | ✅ 완료 | Server Actions only | DB 3테이블 + Actions 12개 + 위저드 UI + 빈도분석 + 공개후기 |
| **Step 2** | **스크립트+쉐도잉** | **⏳ 다음 작업** | **SA + EF** | scripts 통합, RCTF, GPT/Gemini/Whisper |
| Step 3 | 모의고사 | ⏳ 대기 | SA + EF | 5테이블, V7 규칙엔진, Whisper/Azure/GPT |
| Step 4 | 튜터링 | ⏳ 대기 | SA + EF | 6테이블, 4레벨 재설계, GPT/Whisper |

### DB 현황 (현재 7개 테이블)

| 테이블 | 행 수 | 용도 |
|--------|-------|------|
| `master_questions` | 510행 | OPIc 문제 마스터 (시드 로드 완료) |
| `profiles` | - | 사용자 프로필 |
| `orders` | - | 결제 주문 기록 |
| `user_credits` | - | 이용권/크레딧 (회원가입 트리거 자동 생성) |
| `submissions` | 0행 | 시험후기 마스터 + 설문 (Step 1 완료) |
| `submission_questions` | 0행 | 기출 문제 14개 기록 (Step 1 완료) |
| `submission_combos` | 0행 | 콤보 데이터 (Step 1 완료) |

### 바로 다음 작업

1. **스크립트 설계 문서 보강**: 소리담 원본 구현 섹션 추가 (Part A/B/C 구조)
2. **스크립트 DB 설계**: scripts + script_packages + ai_prompt_templates 마이그레이션 SQL
3. **Server Actions**: CRUD (목록/상세/삭제 등)
4. **Edge Functions**: GPT 스크립트 생성, Gemini TTS 패키지, Whisper 쉐도잉 평가
5. **UI 연동**: 스크립트 생성 위저드 + 내 스크립트 + 쉐도잉 훈련

---

*최종 업데이트: 2026-02-23*
*상태: Phase 3 Step 1 시험후기 완료 — Step 2 스크립트+쉐도잉 이관 대기*
